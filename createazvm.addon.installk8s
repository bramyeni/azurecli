# $Id: createazvm.addon.installk8s 449 2022-04-29 02:10:08Z bpahlawa $
# initially created by Bram Pahlawanto 25-June-2020
# This is the list of parameters to deploy VM and SQL BDC fully automated
# $Author: bpahlawa $
# Modified by: bpahlawa
# $Date: 2022-04-29 10:10:08 +0800 (Fri, 29 Apr 2022) $
# $Revision: 449 $

export THEUSER
export FULLVMNAME
export K8SMASTER=lxk8smaster
export K8SNODE=lxk8snode
export NOOFWORKERS=7
export KUBEADM_JOIN_CMD=""

creating_disk()
{
   local MOUNTPOINT="$1"
   echo -n "Creating $MOUNTPOINT filesystem on Linux VM $VMNAME using user $THEUSER remotely..."
   ssh -o "StrictHostKeyChecking no" ${THEUSER}@${FULLVMNAME} "
   [[ \$(mount | grep \"$MOUNTPOINT \" | grep -v grep | wc -l) -ne 0 ]] && echo \"mountpoint $MOUNTPOINT has been created!!\" && exit 1
DISK=\`sudo lsblk -no NAME | grep -Ev \"\$(sudo blkid | sed \"s/^\/dev\/\([a-zA-Z]\+\).*/\1/g\")|sr0|fd0\" | tail -1\`
if [ \"\$DISK\" != \"\" ]
then
   echo \"Creating $MOUNTPOINT disk....\"
   mkdir -p $MOUNTPOINT
   echo yes | sudo mkfs.xfs /dev/\$DISK
   echo \"/dev/\$DISK $MOUNTPOINT xfs defaults 0 0\" | sudo tee -a /etc/fstab
fi
sudo mount $MOUNTPOINT
if [ \$? -ne 0 ]
then
   echo \"Error creating filesystem $MOUNTPOINT on VM $VMNAME ( $FULLVMNAME ).... \" 
   exit 1
else
   echo \"mounting $MOUNTPOINT filesystem..... OK\"
   echo \"$MOUNTPOINT has been created and mounted successfully...\"
fi
"

}

generate_ssh_key()
{
    ssh -o "StrictHostKeyChecking no" ${THEUSER}@${FULLVMNAME} "
hostname
[[ ! -f ~/.ssh/id_rsa ]] && ssh-keygen -f ~/.ssh/id_rsa -N \"\" || echo \"id_rsa and id_rsa.pub have been generated!!\"
"
}

install_packages()
{
   ssh -o "StrictHostKeyChecking no" ${THEUSER}@${FULLVMNAME} "
hostname
apt-get update
apt-get -y upgrade
"
}


copy_createazvm()
{
   scp createazvm.env ${THEUSER}@${FULLVMNAME}:~
   scp createazvm.sh ${THEUSER}@${FULLVMNAME}:~
   scp createazvm.addon.installk8s ${THEUSER}@${FULLVMNAME}:~/remotescript.sh
}

run_createazvm()
{
   ssh -o "StrictHostKeyChecking no" ${THEUSER}@${FULLVMNAME} "
hostname
./createazvm.sh $K8SMASTER
W=0
while [[ \$W -lt $NOOFWORKERS ]]
do
  W=\$(( W + 1 ))
  ./createazvm.sh "${K8SNODE}\${W}"
done
source ~/remotescript.sh
remote_run
"
}


remote_copy_and_run_script()
{
   local SSHREMOTE="$1"
   local SCRIPTNAME="$2"
   local MASTER="$3"
   scp "$SCRIPTNAME" ${SSHREMOTE}:~
   if [ "$MASTER" != "" ]
   then
      ssh -o "StrictHostKeyChecking no" "$SSHREMOTE" "./${SCRIPTNAME} -m reset-master -k /opt/kubelet -c /opt/containers -n f"
   else
      if [ "$KUBEADM_JOIN_CMD" = "" ]
      then
         ssh -o "StrictHostKeyChecking no" "$SSHREMOTE" "export MASTERIP=${K8SMASTER}; ./${SCRIPTNAME} -m reset-worker -k /opt/kubelet -c /opt/containers"
         export KUBEADM_JOIN_CMD=$(ssh -o "StrictHostKeyChecking no" "$SSHREMOTE" "cat k8sdeploy/k8sdeploy.log | grep \"Executing command kubeadm\" |  cut -f3-9 -d' '")
      else
         ssh -o "StrictHostKeyChecking no" "$SSHREMOTE" "export KUBEADM_JOIN_CMD=\"$KUBEADM_JOIN_CMD\"; ./${SCRIPTNAME} -m reset-worker -k /opt/kubelet -c /opt/containers"
      fi
   fi
}

remote_check_createvm_log()
{
  local NODENAME="$1"
  if [ $(tail -1 /tmp/createazvm.sh-${NODENAME}.log | grep "^ERROR:" | wc -l) -eq 0 ]
  then
     return 0
  else
     tail -1 /tmp/createazvm.sh-${NODENAME}.log
     return 1
  fi
}
   

remote_run()
{
  spool_script
  chmod ugo+x setup-k8scrio.sh
  export THEUSER=root
  [[ -f setup-k8scrio.sh ]] && scp setup-k8scrio.sh ${THEUSER}@${K8SMASTER}:~
  export FULLVMNAME=${K8SMASTER}
  creating_disk "/opt"
  ssh -o "StrictHostKeyChecking no" ${THEUSER}@${K8SMASTER} "cat ~/.ssh/authorized_keys" > authorized_keys
  remote_copy_and_run_script "${THEUSER}@${K8SMASTER}" "setup-k8scrio.sh"
  remote_check_createvm_log "$K8SMASTER"
  [[ $? -ne 0 ]] && exit 1

  W=0
  while [[ $W -lt $NOOFWORKERS ]]
  do
     W=$(( W + 1 ))
     remote_check_createvm_log "${K8SNODE}${W}"
     if [ $? -eq 0 ]
     then
        [[ -f setup-k8scrio.sh ]] && scp setup-k8scrio.sh ${THEUSER}@${K8SNODE}${W}:~
        export FULLVMNAME=${K8SNODE}${W}
        creating_disk "/opt"
        generate_ssh_key
        ssh -o "StrictHostKeyChecking no" ${THEUSER}@${K8SNODE}${W} "cat ~/.ssh/id_rsa.pub" >> authorized_keys
        chmod go-rwx authorized_keys
     else
        echo "Error in creating VM ${K8SNODE}${W}"
     fi
  done
  scp authorized_keys ${THEUSER}@${K8SMASTER}:~/.ssh
  remote_copy_and_run_script "${THEUSER}@${K8SMASTER}" "setup-k8scrio.sh" "Y"

  W=0
  while [[ $W -lt $NOOFWORKERS ]]
  do
     W=$(( W + 1 ))
     remote_check_createvm_log "${K8SNODE}${W}"
     if [ $? -eq 0 ]
     then
        remote_copy_and_run_script "${THEUSER}@${K8SNODE}${W}" "setup-k8scrio.sh"
     else
        echo "Skipping VM ${K8SNODE}${W} ..."
     fi
  done
}


run_addon()
{
   generate_ssh_key
   install_packages
   copy_createazvm
   run_createazvm
}


spool_script()
{
echo "IyEvYmluL2Jhc2gKIyAkSWQ6IHNldHVwLWs4c2NyaW8uc2ggNDQ4IDIwMjItMDQtMjYgMDY6Mzk6NDhaIGJwYWhsYXdhICQKIyBpbml0aWFsbHkgY2FwdHVyZWQgZnJvbSBNaWNyb3NvZnQgd2Vic2l0ZQojICRBdXRob3I6IGJwYWhsYXdhICQKIyBNb2RpZmllZCBieTogYnBhaGxhd2EKIyAkRGF0ZTogMjAyMi0wNC0yNiAxNDozOTo0OCArMDgwMCAoVHVlLCAyNiBBcHIgMjAyMikgJAojICRSZXZpc2lvbjogNDQ4ICQKCgp0cmFwIGV4aXRzaGVsbCBTSUdJTlQgU0lHVEVSTQoKQ1VSUkRJUj0kKHB3ZCkKCmV4aXRzaGVsbCgpCnsKICAgZWNobyAtZSAiJHtOT1JNQUxGT05UfUNhbmNlbGxpbmcgc2NyaXB0Li4uLmV4aXRpbmcuLi4uLiIKICAgc3R0eSBzYW5lCiAgIGV4aXQgMAp9CgpleHBvcnQgVEhFVVNFUj0iJHtLVUJFX1VTRVI6LWs4c30iCmV4cG9ydCBTQ1JJUFRESVI9YGRpcm5hbWUgJDBgICYmIFtbICIkU0NSSVBURElSIiA9ICIuIiBdXSAmJiBTQ1JJUFRESVI9YHB3ZGAKZXhwb3J0IEtVQkVQQVJBTUlOSVQ9Ii0tcG9kLW5ldHdvcmstY2lkcj0xMC4yNDQuMC4wLzE2IgpleHBvcnQgREVGQVVMVF9TVE9SQUdFPSIvbW50L2xvY2FsLXN0b3JhZ2UiCmV4cG9ydCBLVUJFU1RPUkFHRT0iJHtLVUJFX1NUT1JBR0U6LS92YXIvbGliL2t1YmVsZXR9IgpleHBvcnQgQ09OVEFJTkVSU1RPUkFHRT0iJHtDT05UQUlORVJfU1RPUkFHRTotL3Zhci9saWIvY29udGFpbmVyc30iCmV4cG9ydCBwYXNzd29yZD0iIgpleHBvcnQgcGFzc3dvcmQyPSJYIgpleHBvcnQgTE9DQUxTVEdNSU5TSVpFPTE1CmV4cG9ydCBESVNUUk89IiIKZXhwb3J0IFZFUlNJT05fSUQ9IiIKZXhwb3J0IEZVTExfVkVSU0lPTl9JRD0iIgpleHBvcnQgQ1JJT19WRVJTSU9OPSIxLjIyIgpleHBvcnQgRkxBTk5FTD0iaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NvcmVvcy9mbGFubmVsL21hc3Rlci9Eb2N1bWVudGF0aW9uL2t1YmUtZmxhbm5lbC55bWwiCmV4cG9ydCBDQUxJQ089Imh0dHBzOi8vZG9jcy5wcm9qZWN0Y2FsaWNvLm9yZy9tYW5pZmVzdHMvY2FsaWNvLnlhbWwiCmV4cG9ydCBDSUxJVU09Imh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9jaWxpdW0vY2lsaXVtLzEuNy4yL2luc3RhbGwva3ViZXJuZXRlcy9xdWljay1pbnN0YWxsLnlhbWwiCiNleHBvcnQgREFTSEJPQVJEPSJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20va3ViZXJuZXRlcy9kYXNoYm9hcmQvdjEuMTAuMS9zcmMvZGVwbG95L3JlY29tbWVuZGVkL2t1YmVybmV0ZXMtZGFzaGJvYXJkLnlhbWwiCmV4cG9ydCBEQVNIQk9BUkQ9Imh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9rdWJlcm5ldGVzL2Rhc2hib2FyZC9tYXN0ZXIvYWlvL2RlcGxveS9yZWNvbW1lbmRlZC55YW1sIgpleHBvcnQgTEFORz1lbl9VUy5VVEYtOAojIFdhaXQgZm9yIDUgbWludXRlcyBmb3IgdGhlIGNsdXN0ZXIgdG8gYmUgcmVhZHkuCiMKZXhwb3J0IFRJTUVPVVQ9NjAwCmV4cG9ydCBSRVRSWV9JTlRFUlZBTD01CgoKZ2V0X2Rpc3Ryb192ZXJzaW9uKCkKewogICBpZiBbIC1mIC9ldGMvb3MtcmVsZWFzZSBdCiAgIHRoZW4KICAgICAgQUxMVkVSPWBzZWQgLW4gJzphO047JGJiO2JhOzpiO3MvLipWRVJTSU9OX0lEPSJcKFswLTlcLl1cK1wpIi4qL1wxL3AnIC9ldGMvb3MtcmVsZWFzZWAKICAgICAgW1sgIiRBTExWRVIiID0gIiIgXV0gJiYgQUxMVkVSPSIwIgogICAgICBGVUxMX1ZFUlNJT05fSUQ9IiRBTExWRVIiCiAgICAgIFZFUlNJT05fSUQ9YGVjaG8gJEFMTFZFUiB8IGN1dCAtZjEgLWQiLiJgCiAgICAgIGV4cG9ydCBESVNUUk89YHNlZCAtbiAncy9eSURbIFx8PV1cKC4qXCkvXDEvcCcgL2V0Yy9vcy1yZWxlYXNlIHwgc2VkICdzLyIvL2cnYAogICAgICBESVNUUk89JHtESVNUUk9eXn0KICAgZWxzZQogICAgICBlY2hvICJVbnN1cHBvcnRlZCBvcGVyYXRpbmcgc3lzdGVtIHZlcnNpb24hISIKICAgICAgZXhpdCAxCiAgIGZpCn0KICAgCgppZiBbICIkRVVJRCIgLW5lIDAgXQogIHRoZW4gZWNobyAiUGxlYXNlIHJ1biBhcyByb290IgogIGV4aXQKZmkKCmV4cG9ydCBLOFNERVBMT1lfRElSPWs4c2RlcGxveQoKIyBOYW1lIG9mIHZpcnR1YWxlbnYgdmFyaWFibGUgdXNlZC4KIwpleHBvcnQgTE9HX0ZJTEU9Ims4c2RlcGxveS5sb2ciCmV4cG9ydCBQUk9HUkVTU19GSUxFPSJrOHNwcm9ncmVzcy5sb2ciCmV4cG9ydCBERUJJQU5fRlJPTlRFTkQ9bm9uaW50ZXJhY3RpdmUKZXhwb3J0IFBWX0NPVU5UPSIke1BWQ09VTlQ6LTMwfSIKCiMgS3ViZSB2ZXJzaW9uLgojCiNLVUJFX0RQS0dfVkVSU0lPTj0xLjE3LjQtMDAKI0tVQkVfVkVSU0lPTj0xLjE3LjQKCiMgTWFrZSBhIGRpcmVjdG9yeSBmb3IgaW5zdGFsbGluZyB0aGUgc2NyaXB0cyBhbmQgbG9ncy4KIwpta2RpciAtcCAkSzhTREVQTE9ZX0RJUgpjZCAkSzhTREVQTE9ZX0RJUi8KdG91Y2ggJExPR19GSUxFCnRvdWNoICRQUk9HUkVTU19GSUxFCgpyZXNldF9rdWJlYWRtKCkKewoKICAgcm0gLXJmIC9ldGMvY25pCiAgIHJtIC1yZiAvZXRjL2t1YmVybmV0ZXMKICAgcm0gLXJmIC92YXIvbGliL2NuaQogICBybSAtcmYgL3Zhci9saWIvZXRjZAogICBybSAtcmYgL2V0Yy9jbmkKICAgcm0gLXJmIC92YXIvcnVuL2t1YmVybmV0ZXMKICAgcm0gLXJmIC92YXIvbG9nL3BvZHMKICAgcm0gLXJmIC92YXIvbG9nL2NvbnRhaW5lcnMKICAgW1sgLWQgL3Zhci9saWIvZXRjZCBdXSAmJiBybSAtcmYgL3Zhci9saWIvZXRjZC8qCiAgIGlwIGxpbmsgbGlzdCBrdWJlLWlwdnMwIDI+L2Rldi9udWxsIDE+L2Rldi9udWxsCiAgIFtbICQ/IC1lcSAwIF1dICYmIGVjaG8gIkRlbGV0aW5nIGt1YmUtaXB2czAuLi4uIiAmJiBpcCBsaW5rIHNldCBkZXYga3ViZS1pcHZzMCBkb3duICYmIGlwIGxpbmsgZGVsZXRlIGt1YmUtaXB2czAKICAgW1sgLWQgL3J1bi9jYWxpY28gXV0gJiYgcm0gLXJmIC9ydW4vY2FsaWNvCiAgIFtbICQoaXAgbGluayBsaXN0IHwgZ3JlcCB0dW5sMCAgfCB3YyAtbCkgLW5lIDAgXV0gJiYgZWNobyAiRGVsZXRpbmcgaW50ZXJmYWNlIGNhbGljbyB0dW5sMC4uLi4iICYmIG1vZHByb2JlIC1yIGlwaXAKICAgW1sgLWQgL3J1bi9mbGFubmVsIF1dICYmIHJtIC1yZiAvcnVuL2ZsYW5uZWwKICAgaXAgbGluayBsaXN0IGZsYW5uZWwuMSAyPi9kZXYvbnVsbCAxPi9kZXYvbnVsbAogICBbWyAkPyAtZXEgMCBdXSAmJiBlY2hvICJEZWxldGluZyBpbnRlcmZhY2UgZmxhbm5lbCBmbGFubmVsLjEuLi4uIiAmJiBpcCBsaW5rIHNldCBkZXYgZmxhbm5lbC4xIGRvd24gJiYgaXAgbGluayBkZWxldGUgZmxhbm5lbC4xCgogICBbWyAtZCAvcnVuL2NpbGl1bSBdXSAmJiBybSAtcmYgL3J1bi9jaWxpdW0KICAgaXAgbGluayBsaXN0IGNpbGl1bV9ob3N0IDI+L2Rldi9udWxsIDE+L2Rldi9udWxsCiAgIFtbICQ/IC1lcSAwIF1dICYmIGVjaG8gIkRlbGV0aW5nIGludGVyZmFjZSBjaWxpdW0gaG9zdCBhbmQgbmV0Li4uLiIgJiYgaXAgbGluayBkZWxldGUgY2lsaXVtX3Z4bGFuICYmIGlwIGxpbmsgZGVsZXRlIGNpbGl1bV9uZXQgJiYgaXAgbGluayBkZWxldGUgY2lsaXVtX2hvc3QKCiAgIGlwIGxpbmsgbGlzdCB3ZWF2ZSAyPi9kZXYvbnVsbCAxPi9kZXYvbnVsbAogICBpZiBbICQ/IC1lcSAwIF0KICAgdGhlbgogICAgICBlY2hvICJEZWxldGluZyBpbnRlcmZhY2Ugd2VhdmVuZXQgd2VhdmUuLi4uIiAKICAgICAgW1sgLWQgL3Vzci9sb2NhbC9iaW4gXV0gJiYgbWtkaXIgLXAgL3Vzci9sb2NhbC9iaW4KICAgICAgY3VybCAtTCBnaXQuaW8vd2VhdmUgLW8gL3Vzci9sb2NhbC9iaW4vd2VhdmUgCiAgICAgIGNobW9kIHVnbyt4IC91c3IvbG9jYWwvYmluL3dlYXZlCiAgICAgIC91c3IvbG9jYWwvYmluL3dlYXZlIHN0b3AKICAgICAgL3Vzci9sb2NhbC9iaW4vd2VhdmUgcmVzZXQgLS1mb3JjZQogICAgICBpcCBsaW5rIHNldCBkZXYgd2VhdmUgZG93biAKICAgICAgaXAgbGluayBkZWxldGUgd2VhdmUKICAgZmkKICAgaXAgbGluayBsaXN0IGRhdGFwYXRoIDI+L2Rldi9udWxsIDE+L2Rldi9udWxsCiAgIFtbICQ/IC1lcSAwIF1dICYmIGN1cmwgLUwgZ2l0LmlvL3dlYXZlIC1vIC90bXAvd2VhdmUgJiYgY2htb2QgdWdvK3J4IC90bXAvd2VhdmUKCiAgIGlwIGxpbmsgbGlzdCBjbmkwIDI+L2Rldi9udWxsIDE+L2Rldi9udWxsCiAgIGlmIFsgJD8gLWVxIDAgXQogICB0aGVuCiAgICAgIGVjaG8gIkRlbGV0aW5nIGludGVyZmFjZSBjbmkwLi4uLiIKICAgICAgaXAgbGluayBzZXQgZGV2IGNuaTAgZG93bgogICAgICBpcCBsaW5rIGRlbGV0ZSBjbmkwCiAgIGZpCiAgIGlmIFsgIiRLVUJFQURNX0pPSU5fQ01EIiAhPSAiIiBdCiAgIHRoZW4KICAgICAgTUFTVEVSTk9ERT1gZWNobyAkS1VCRUFETV9KT0lOX0NNRCB8IGF3ayAne3ByaW50ICQzfScgfCBjdXQgLWYxIC1kJzonYAogICAgICBzc2ggLW8gIlN0cmljdEhvc3RLZXlDaGVja2luZyBubyIgJE1BU1RFUk5PREUgImt1YmVjdGwgLS1rdWJlY29uZmlnPS9ldGMva3ViZXJuZXRlcy9hZG1pbi5jb25mIGRlbGV0ZSBcJChrdWJlY3RsIC0ta3ViZWNvbmZpZz0vZXRjL2t1YmVybmV0ZXMvYWRtaW4uY29uZiBnZXQgbm9kZXMgYGhvc3RuYW1lYCAtbyBOQU1FIDI+L2Rldi9udWxsKSIKICAgZmkKCn0KCmRlc3Ryb3lfZXZlcnl0aGluZygpCnsKZWNobyAiIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyIKZWNobyAiIyMjIyMjIyBEZXN0cm95aW5nIGFuZCBVbmluc3RhbGxpbmcgS3ViZXJuZXRlcyBhbmQgaXRzIGNvbXBvbmVudHMgIyMjIyMjIyIKZWNobyAiIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyIKICAgS1VCRVBJRD0kKHBzIC1lbyBwaWQsY21kIHwgZ3JlcCAiYmluL2t1YmVsZXQiIHwgZ3JlcCAtdiBncmVwIHwgYXdrICd7cHJpbnQgJDF9JykKICAgW1sgIiRLVUJFUElEIiAhPSAiIiBdXSAmJiBlY2hvICJLaWxsaW5nIGt1YmVsZXQuLi4iICYmIHN5c3RlbWN0bCBzdG9wIGt1YmVsZXQgJiYga2lsbCAtOSAkS1VCRVBJRCAyPi9kZXYvbnVsbCAxPi9kZXYvbnVsbAogICBrdWJlYWRtIHJlc2V0ICR7S1VCRUFETUFSR30gLWYgPDxFT0YKeQpFT0YKICAgIHN5c3RlbWN0bCBzdG9wIGNyaW8KICAgaXB0YWJsZXMgLUYgJiYgaXB0YWJsZXMgLXQgbmF0IC1GICYmIGlwdGFibGVzIC10IG1hbmdsZSAtRiAmJiBpcHRhYmxlcyAtWAogICB3aGljaCBuZnQKICAgW1sgJD8gLWVxIDAgXV0gJiYgbmZ0IGZsdXNoIHJ1bGVzZXQKICAgZm9yIE1OVFBPSU5UIGluIGBkZiB8IGF3ayAne3ByaW50ICRORn0nIHwgZWdyZXAgImt1YmVsZXR8XC92b2x8Y29udGFpbmVycyJgCiAgIGRvCiAgICAgICB1bW91bnQgJE1OVFBPSU5UCiAgIGRvbmUKICAgZm9yIE1OVFBPSU5UIGluIGBtb3VudCB8IGVncmVwICJrdWJlbGV0fFwvdm9sfGNvbnRhaW5lcnMiIHwgYXdrICd7cHJpbnQgJDN9J2AKICAgZG8KICAgICAgdW1vdW50ICRNTlRQT0lOVAogICAgICBybSAtcmYgJE1OVFBPSU5UCiAgIGRvbmUKCiAgIHJlc2V0X2t1YmVhZG0KICAgZGVsZXRlX2VwaGVtZXJhbF9kaXNrcwogICAKICAgW1sgLUwgL3Zhci9saWIva3ViZWxldCBdXSAmJiBybSAtcmYgJChyZWFkbGluayAvdmFyL2xpYi9rdWJlbGV0KSAmJiBybSAtZiAvdmFyL2xpYi9rdWJlbGV0CiAgIFtbIC1kIC92YXIvbGliL2t1YmVsZXQgXV0gJiYgcm0gLXJmIC92YXIvbGliL2t1YmVsZXQKICAgW1sgLUwgL3Zhci9saWIvY29udGFpbmVycyBdXSAmJiBybSAtcmYgJChyZWFkbGluayAvdmFyL2xpYi9jb250YWluZXJzKSAmJiBybSAtZiAvdmFyL2xpYi9jb250YWluZXJzCiAgIFtbIC1kIC92YXIvbGliL2NvbnRhaW5lcnMgXV0gJiYgcm0gLXJmIC92YXIvbGliL2NvbnRhaW5lcnMKICAgZ2V0X2Rpc3Ryb192ZXJzaW9uCiAgIGNhc2UgIiRESVNUUk8iIGluCiAgICAiQ0VOVE9TInwiUkhFTCIpCgkgICAgW1sgLWYgL2xpYi9zeXN0ZW1kL3N5c3RlbS9jb250YWluZXJkLnNlcnZpY2UgXV0gJiYgeXVtIHJlbW92ZSAteSBjb250YWluZXJkKgogICAgICAgICAgICB5dW0gcmVtb3ZlIC15IGt1YmUqCgkgICAgeXVtIHJlbW92ZSAteSBjcmlvKgogICAgICAgICAgICBbWyAtZiAvZXRjL3l1bS5yZXBvcy5kL2t1YmVybmV0ZXMucmVwbyBdXSAmJiBybSAtZiAvZXRjL3l1bS5yZXBvcy5kL2t1YmVybmV0ZXMucmVwbwoJICAgIDs7CgogICAgIlVCVU5UVSJ8IkRFQklBTiIpCiAgICAgICAgICAgIGFwdC1nZXQgcHVyZ2UgLXkga3ViZSoKICAgICAgICAgICAgW1sgLWYgL2xpYi9zeXN0ZW1kL3N5c3RlbS9jb250YWluZXJkLnNlcnZpY2UgXV0gJiYgYXB0LWdldCBwdXJnZSAteSBjb250YWluZXJkKgoJICAgIGFwdC1nZXQgcHVyZ2UgLXkgY3JpLW8gY3JpLW8tcnVuYwogICAgICAgICAgICBbWyAtZiAvZXRjL2FwdC9zb3VyY2VzLmxpc3QuZC9rdWJlcm5ldGVzLmxpc3QgXV0gJiYgcm0gLWYgL2V0Yy9hcHQvc291cmNlcy5saXN0LmQva3ViZXJuZXRlcy5saXN0CgkgICAgOzsKICAgICJBUkNIIikKCSAgICBwYWNtYW4gLVJzIGt1YmVhZG0tYmluIGt1YmVsZXQtYmluIGt1YmVjdGwtYmluIGt1YmVybmV0ZXMtY25pLWJpbiBjcmktbyBjcmljdGwKCSAgICA7OwogICAgIlNVU0UiKSAKICAgICAgICAgICAgenlwcGVyIHJlbW92ZSBjcmktbwogICAgICAgICAgICA7OwogICBlc2FjCgogICBmaW5kIC8gXCggLW5hbWUgImt1YmVsZXQiIFwpIC1leGVjIHJtIC1yZiB7fSBcOyAgMj4vZGV2L251bGwKICAgY2QgJENVUlJESVIgCiAgIFtbIC1kICRLOFNERVBMT1lfRElSIF1dICYmIHJtIC1yZiAkSzhTREVQTE9ZX0RJUgoKfQoKbW9kaWZ5X3NzbF9jb25maWcoKQp7CiAgICBpZiBbICIkRElTVFJPIiA9ICJERUJJQU4iIC1hICIkVkVSU0lPTl9JRCIgLWdlIDEwIF0KICAgIHRoZW4KICAgICAgIFNTTENPTkZJRz1gZmluZCAvZXRjIC1uYW1lICJvcGVuc3NsKmNuZiJgCiAgICAgICBpZiBbICIkU1NMQ09ORklHIiAhPSAiIiBdCiAgICAgICB0aGVuCiAgICAgICAgICBERUJJQU4xMFNTTENPTkZJRz1gc2VkIC1uICJzL15cKFxbZGVmYXVsdF9jb25mLipcKS9cMS9wIiAkU1NMQ09ORklHYAogICAgICAgICAgaWYgWyAiJERFQklBTjEwU1NMQ09ORklHIiAhPSAiIiBdCiAgICAgICAgICB0aGVuCiAgICAgICAgICBlY2hvICJNb2RpZnlpbmcgJFNTTENPTkZJRyBhcyBLdWJlcm5ldGVzIGlzIG5vdCBjb21wYXRpYmxlIHdpdGggVExTIHYxLjIgb3IgbGF0ZXIuLi4uIgogICAgICAgICAgICAgc2VkIC1pICJzL15cKFxbZGVmYXVsdF9jb25mLipcKS9cbiNDb21tZW50ZWQgb3V0IGJ5IHNldHVwLWJkYy5zaCAkKGRhdGUpXG4jXDEvZzsgcy9eXChzc2xfY29uZi4qXHxvcGVuc3NsX2NvbmYuKlwpLyNcMS9nIiAkU1NMQ09ORklHCiAgICAgICAgICBmaQogICAgICAgZmkKICAgICAgIHVwZGF0ZS1hbHRlcm5hdGl2ZXMgLS1zZXQgaXB0YWJsZXMgL3Vzci9zYmluL2lwdGFibGVzLWxlZ2FjeQogICAgICAgdXBkYXRlLWFsdGVybmF0aXZlcyAtLXNldCBpcDZ0YWJsZXMgL3Vzci9zYmluL2lwNnRhYmxlcy1sZWdhY3kKICAgICAgIFtbIC1mIC91c3Ivc2Jpbi9hcnB0YWJsZXMtbGVnYWN5IF1dICYmIHVwZGF0ZS1hbHRlcm5hdGl2ZXMgLS1zZXQgYXJwdGFibGVzIC91c3Ivc2Jpbi9hcnB0YWJsZXMtbGVnYWN5CiAgICAgICB1cGRhdGUtYWx0ZXJuYXRpdmVzIC0tc2V0IGVidGFibGVzIC91c3Ivc2Jpbi9lYnRhYmxlcy1sZWdhY3kKCiAgICBlbGlmIFsgXCggIiRESVNUUk8iID0gIkNFTlRPUyIgLW8gIiRESVNUUk8iID0gIlJIRUwiIFwpIC1hICRWRVJTSU9OX0lEIC1nZSA4IF0KICAgIHRoZW4KICAgICAgIGVjaG8gIkNoZWNraW5nIGNyeXB0byBwb2xpY3kgb2YgJERJU1RSTyAkVkVSU0lPTl9JRCIKICAgICAgIENSWVBUT1ZFUj1gdXBkYXRlLWNyeXB0by1wb2xpY2llcyAtLXNob3dgCiAgICAgICBlY2hvICJDdXJyZW50IGNyeXB0byBwb2xpY3kgaXMgJENSWVBUT1ZFUiIKICAgICAgIFtbICIkQ1JZUFRPVkVSIiAhPSAiTEVHQUNZIiBdXSAmJiBlY2hvICJTZXR0aW5nIGNyeXB0byBwb2xpY3kgdG8gTEVHQUNZLi4iICYmIHVwZGF0ZS1jcnlwdG8tcG9saWNpZXMgLS1zZXQgTEVHQUNZCiAgICBlbHNlCiAgICAgICBlY2hvICJDdXJyZW50IGNyeXB0byBwb2xpY3kgaXMgc3VpdGFibGUgZm9yIHRoaXMga3ViZXJuZXRlcyBjbHVzdGVyLi4uLi4uLi4uLi4iCiAgICBmaQp9CgppbnN0YWxsX3BrZ19jZW50b3MoKQp7CiAgIGVjaG8gIkNoZWNraW5nIGt1YmVybmV0ZXMgdmVyc2lvbi4uLiIKICAgSzhTVkVSPWBrdWJlbGV0IC0tdmVyc2lvbiB8IHNlZCAtbiAgJ3MvLip2WzAtOV0uXChbMC05XVwrXCkuL1wxL3AnYAogICAgICBbWyAkSzhTVkVSIC1sdCAxNzAgXV0gJiYgZWNobyAiUmVtb3Zpbmcga3ViZXJuZXRlcyB2ZXJzaW9uICRLOFNWRVIgb24gJERJU1RSTy4uLiIgJiYgeXVtIHJlbW92ZSAteSBrdWJlKgogICAKICAgZWNobyAiVXBkYXRpbmcgY2VudG9zLi4uLiIKICAgeXVtLWNvbXBsZXRlLXRyYW5zYWN0aW9uIC0tY2xlYW51cC1vbmx5CiAgIHl1bSB1cGRhdGUgYWxsCiAgIHl1bSB1cGRhdGUgLXkKICAgZWNobyAiSW5zdGFsbGluZyBsaWJyYXJpZXMuLi4uLiIKICAgeXVtIGluc3RhbGwgLXkgY3VybCBjYS1jZXJ0aWZpY2F0ZXMgc29mdHdhcmUtcHJvcGVydGllcy1jb21tb24geXVtLXV0aWxzIGRldmljZS1tYXBwZXItcGVyc2lzdGVudC1kYXRhIGx2bTIgd2dldAogICAKICAgaWYgWyAhIC1mIC9ldGMvYXB0L3NvdXJjZXMubGlzdC5kL2RldmVsOmt1YmljOmxpYmNvbnRhaW5lcnM6c3RhYmxlOmNyaS1vOiRDUklPX1ZFUlNJT04ubGlzdCBdCiAgIHRoZW4KICAgICAgIGN1cmwgLUwgaHR0cHM6Ly9kb3dubG9hZC5vcGVuc3VzZS5vcmcvcmVwb3NpdG9yaWVzL2RldmVsOi9rdWJpYzovbGliY29udGFpbmVyczovc3RhYmxlL0NlbnRPU18ke1ZFUlNJT05fSUR9L2RldmVsOmt1YmljOmxpYmNvbnRhaW5lcnM6c3RhYmxlLnJlcG8gPiAvZXRjL3l1bS5yZXBvcy5kL2RldmVsOmt1YmljOmxpYmNvbnRhaW5lcnM6c3RhYmxlLnJlcG8KICAgICAgIGN1cmwgLUwgaHR0cDovL2Rvd25sb2FkLm9wZW5zdXNlLm9yZy9yZXBvc2l0b3JpZXMvZGV2ZWw6L2t1YmljOi9saWJjb250YWluZXJzOi9zdGFibGU6L2NyaS1vOi8kQ1JJT19WRVJTSU9OL0NlbnRPU18ke1ZFUlNJT05fSUR9L2RldmVsOmt1YmljOmxpYmNvbnRhaW5lcnM6c3RhYmxlOmNyaS1vOjEuMjIucmVwbyA+IC9ldGMveXVtLnJlcG9zLmQvZGV2ZWw6a3ViaWM6bGliY29udGFpbmVyczpzdGFibGU6Y3JpLW86MS4yMi5yZXBvCiAgIGZpCiAgIAogICBlY2hvICJBZGRpbmcga3ViZXJuZXRlcyByZXBvLi4uLiIKICAgY2F0IDw8RU9GID4gL2V0Yy95dW0ucmVwb3MuZC9rdWJlcm5ldGVzLnJlcG8KW2t1YmVybmV0ZXNdCm5hbWU9S3ViZXJuZXRlcwpiYXNldXJsPWh0dHBzOi8vcGFja2FnZXMuY2xvdWQuZ29vZ2xlLmNvbS95dW0vcmVwb3Mva3ViZXJuZXRlcy1lbDcteDg2XzY0CmVuYWJsZWQ9MQpncGdjaGVjaz0xCnJlcG9fZ3BnY2hlY2s9MQpncGdrZXk9aHR0cHM6Ly9wYWNrYWdlcy5jbG91ZC5nb29nbGUuY29tL3l1bS9kb2MveXVtLWtleS5ncGcgaHR0cHM6Ly9wYWNrYWdlcy5jbG91ZC5nb29nbGUuY29tL3l1bS9kb2MvcnBtLXBhY2thZ2Uta2V5LmdwZwpFT0YKCiAgIGVjaG8gIkluc3RhbGwga3ViZWxldCBrdWJlYWRtIGFuZCBrdWJlY3RsLi4uIgogICB5dW0gaW5zdGFsbCAteSBrdWJlbGV0IGt1YmVhZG0ga3ViZWN0bCAtLWRpc2FibGVleGNsdWRlcz1rdWJlcm5ldGVzCiAgIGVjaG8gIkluc3RhbGxpbmcgZWJ0YWJsZXMgYW5kIGV0aHRvb2wuLi4iCiAgIHl1bSBpbnN0YWxsIC15IGVidGFibGVzIGV0aHRvb2wKICAgZWNobyAiSW5zdGFsbGluZyBjcmktbyBhbmQgY3JpLW8tcnVuYy4uLiIKICAgeXVtIGluc3RhbGwgLXkgY3JpLW8gY3JpLW8tcnVuYwogICBhZGRfY3Jpb19uZXRjb25maWcKICAgc3lzdGVtY3RsIHJlc3RhcnQgY3JpbwogICBleHBvcnQgS1VCRUFETUFSRz0iLS1jcmktc29ja2V0IC92YXIvcnVuL2NyaW8vY3Jpby5zb2NrIgoKCn0KCmluc3RhbGxfcGtnX3N1c2UoKQp7CiAgIHp5cHBlciAtbiB1cGRhdGUKICAgenlwcGVyIC1uIGluIGN1cmwgc29jYXQgZWJ0YWJsZXMgCiAgIHp5cHBlciAtbiBpbiBicmlkZ2UtdXRpbHMKICAgenlwcGVyIGFkZHJlcG8gLUcgaHR0cHM6Ly9kb3dubG9hZC5vcGVuc3VzZS5vcmcvcmVwb3NpdG9yaWVzL2hvbWU6ZGFyaXg6YXBwcy9TTEVfMTVfU1AxL2hvbWU6ZGFyaXg6YXBwcy5yZXBvCiAgIHp5cHBlciBhZGRyZXBvIC1HIGh0dHBzOi8vZG93bmxvYWQub3BlbnN1c2Uub3JnL3JlcG9zaXRvcmllcy9ob21lOlJCcm93blNVU0U6azExODp2Mi9vcGVuU1VTRV9UdW1ibGV3ZWVkL2hvbWU6UkJyb3duU1VTRTprMTE4OnYyLnJlcG8KICAgenlwcGVyIHJlZgogICB6eXBwZXIgLW4gaW4gY3JpLW8ga3ViZXJuZXRlcy1rdWJlYWRtCiAgIHp5cHBlciAtbiBpbiBrdWJlcm5ldGVzLWt1YmVsZXQKICAgenlwcGVyIC1uIHJlbW92ZSBrdWJlcm5ldGVzLWNsaWVudAogICB6eXBwZXIgLW4gaW4ga3ViZXJuZXRlcy1jbGllbnQKICAgaWYgWyAtZiAvZXRjL3N5c2NvbmZpZy9rdWJlbGV0IF0KICAgdGhlbgogICAgICBpZiBbIGBncmVwICJLVUJFTEVUX0VYVFJBX0FSR1MiIC9ldGMvc3lzY29uZmlnL2t1YmVsZXQgfCB3YyAtbGAgLW5lIDAgXQogICAgICB0aGVuCiAgICAgICAgIFtbIC1mIC91c3IvbGliL2NuaS9icmlkZ2UgXV0gJiYgc2VkIC1pICdzL1woS1VCRUxFVF9FWFRSQV9BUkdTLipcKSJcKC4qXCkiL1wxIi0tY25pLWJpbi1kaXI9XC91c3JcL2xpYlwvY25pIi9nJyAvZXRjL3N5c2NvbmZpZy9rdWJlbGV0CiAgICAgIGVsc2UKICAgICAgICAgZWNobyAiS1VCRUxFVF9FWFRSQV9BUkdTPVwiLS1jbmktYmluLWRpcj0vdXNyL2xpYi9jbmlcIiIgPj4gL2V0Yy9zeXNjb25maWcva3ViZWxldAogICAgICBmaQogICBmaQogICBleHBvcnQgS1VCRUFETUFSRz0iLS1jcmktc29ja2V0IC92YXIvcnVuL2RvY2tlcnNoaW0uc29jayIKfQoKaW5zdGFsbF9wa2dfdWJ1bnR1KCkKewoKICAgaWYgWyBgZ3JlcCAiXmVuX1VTLlVURi04IiAvZXRjL2xvY2FsZS5nZW4gfCB3YyAtbGAgLWVxIDAgXQogICB0aGVuCiAgICAgIGVjaG8gImVuX1VTLlVURi04IFVURi04IiA+PiAgL2V0Yy9sb2NhbGUuZ2VuCiAgICAgIGRwa2ctcmVjb25maWd1cmUgbG9jYWxlcwogICBmaQoKICAgZWNobyAiQ2hlY2tpbmcga3ViZXJuZXRlcyB2ZXJzaW9uLi4uIgogICBLOFNWRVI9YGt1YmVsZXQgLS12ZXJzaW9uIDI+L2Rldi9udWxsfCBzZWQgLW4gICdzLy4qdlswLTldLlwoWzAtOV1cK1wpLi9cMS9wJyAyPi9kZXYvbnVsbGAKICAgW1sgJEs4U1ZFUiAtbHQgMTcwIF1dICYmIGVjaG8gIlJlbW92aW5nIGt1YmVybmV0ZXMgdmVyc2lvbiAkSzhTVkVSIG9uIFVCVU5UVS4uLiIgJiYgYXB0IC0teWVzIHB1cmdlIGt1YmUqCiAgIGFwdCAtLXllcyBpbnN0YWxsIGN1cmwgbHNiLXJlbGVhc2UKICAgY3VybCAtZnNTTCBodHRwczovL2Rvd25sb2FkLmRvY2tlci5jb20vbGludXgvdWJ1bnR1L2dwZyB8IGFwdC1rZXkgYWRkIC0KICAgY3VybCAtc0wgaHR0cHM6Ly9wYWNrYWdlcy5jbG91ZC5nb29nbGUuY29tL2FwdC9kb2MvYXB0LWtleS5ncGcgfCBhcHQta2V5IGFkZCAtCiAgIGlmIFsgISAtZiAvZXRjL2FwdC9zb3VyY2VzLmxpc3QuZC9kZXZlbDprdWJpYzpsaWJjb250YWluZXJzOnN0YWJsZTpjcmktbzokQ1JJT19WRVJTSU9OLmxpc3QgXQogICB0aGVuCiAgICAgICBlY2hvICJkZWIgaHR0cHM6Ly9kb3dubG9hZC5vcGVuc3VzZS5vcmcvcmVwb3NpdG9yaWVzL2RldmVsOi9rdWJpYzovbGliY29udGFpbmVyczovc3RhYmxlL3hVYnVudHVfJHtGVUxMX1ZFUlNJT05fSUR9LyAvInwgdGVlIC9ldGMvYXB0L3NvdXJjZXMubGlzdC5kL2RldmVsOmt1YmljOmxpYmNvbnRhaW5lcnM6c3RhYmxlLmxpc3QKICAgICAgIGN1cmwgLUwgaHR0cHM6Ly9kb3dubG9hZC5vcGVuc3VzZS5vcmcvcmVwb3NpdG9yaWVzL2RldmVsOi9rdWJpYzovbGliY29udGFpbmVyczovc3RhYmxlL3hVYnVudHVfJHtGVUxMX1ZFUlNJT05fSUR9L1JlbGVhc2Uua2V5IHwgc3VkbyBhcHQta2V5IGFkZCAtCiAgICAgICBlY2hvICJkZWIgaHR0cDovL2Rvd25sb2FkLm9wZW5zdXNlLm9yZy9yZXBvc2l0b3JpZXMvZGV2ZWw6L2t1YmljOi9saWJjb250YWluZXJzOi9zdGFibGU6L2NyaS1vOi8kQ1JJT19WRVJTSU9OL3hVYnVudHVfJHtGVUxMX1ZFUlNJT05fSUR9LyAvInxzdWRvIHRlZSAvZXRjL2FwdC9zb3VyY2VzLmxpc3QuZC9kZXZlbDprdWJpYzpsaWJjb250YWluZXJzOnN0YWJsZTpjcmktbzokQ1JJT19WRVJTSU9OLmxpc3QKICAgICAgIGN1cmwgLUwgaHR0cHM6Ly9kb3dubG9hZC5vcGVuc3VzZS5vcmcvcmVwb3NpdG9yaWVzL2RldmVsOi9rdWJpYzovbGliY29udGFpbmVyczovc3RhYmxlL3hVYnVudHVfJHtGVUxMX1ZFUlNJT05fSUR9L1JlbGVhc2Uua2V5IHwgc3VkbyBhcHQta2V5IGFkZCAtCiAgIGZpCiAgIGlmIFsgISAtZiAvZXRjL2FwdC9zb3VyY2VzLmxpc3QuZC9rdWJlcm5ldGVzLmxpc3QgXQogICB0aGVuCiAgICAgIEs4U1JFUE89YGN1cmwgLUwgaHR0cDovL2FwdC5rdWJlcm5ldGVzLmlvL2Rpc3RzIHwgZ3JlcCAia3ViZXJuZXRlcy0kKGxzYl9yZWxlYXNlIC1jcykiIHwgc2VkICdzLy4qPlwoW2EtelwtXVwrXCk8LiovXDEvZycgfCBncmVwIC1FdiAndXBkYXRlfHVuc3RhYmxlJ2AKICAgICAgW1sgIiRLOFNSRVBPIiA9ICIiIF1dICYmIEs4U1JFUE89Imt1YmVybmV0ZXMteGVuaWFsIgogICAgICBjYXQgPDxFT0YgPi9ldGMvYXB0L3NvdXJjZXMubGlzdC5kL2t1YmVybmV0ZXMubGlzdApkZWIgaHR0cDovL2FwdC5rdWJlcm5ldGVzLmlvLyAkSzhTUkVQTyBtYWluCkVPRgogICBmaQogICBhcHQtZ2V0IHVwZGF0ZSAtcQogICBhcHQtZ2V0IHVwZ3JhZGUgLXkgLXEKICAgYXB0IC0teWVzIGluc3RhbGwgYXB0LXRyYW5zcG9ydC1odHRwcyBzb2Z0d2FyZS1wcm9wZXJ0aWVzLWNvbW1vbiBzZWxpbnV4LXV0aWxzIGVidGFibGVzIGV0aHRvb2wKICAgYXB0LWdldCBpbnN0YWxsIC1xIC15IHB5dGhvbjMgcHl0aG9uMy1waXAgcHl0aG9uMy1kZXYgbG9jYWxlcyBicmlkZ2UtdXRpbHMKICAgYXB0LWdldCBpbnN0YWxsIC1xIC15IGxpYmtyYjUtZGV2IGxpYnNxbGl0ZTMtZGV2IHVuaXhvZGJjLWRldgogICBhcHQtZ2V0IGluc3RhbGwgLXEgLXkga3ViZWxldCBrdWJlYWRtIGt1YmVjdGwKICAgYXB0LWdldCBpbnN0YWxsIC1xIC15IGNwcAogICBhcHQtZ2V0IGluc3RhbGwgLXEgLXkgY3JpLW8gY3JpLW8tcnVuYwogICBsb2NhbGUtZ2VuIGVuX1VTLlVURi04CiAgIGV4cG9ydCBLVUJFQURNQVJHPSItLWNyaS1zb2NrZXQgL3Zhci9ydW4vY3Jpby9jcmlvLnNvY2siCiAgIFBJUD1waXAzCiAgIGFkZF9jcmlvX25ldGNvbmZpZwogICBzeXN0ZW1jdGwgcmVzdGFydCBjcmlvCn0KCgppbnN0YWxsX3BrZ19kZWJpYW4oKQp7CiAgIGlmIFsgYGdyZXAgIl5lbl9VUy5VVEYtOCIgL2V0Yy9sb2NhbGUuZ2VuIHwgd2MgLWxgIC1lcSAwIF0KICAgdGhlbgogICAgICBlY2hvICJlbl9VUy5VVEYtOCBVVEYtOCIgPj4gIC9ldGMvbG9jYWxlLmdlbgogICAgICBkcGtnLXJlY29uZmlndXJlIGxvY2FsZXMKICAgZmkKCiAgIGlmIFsgLWYgL3Zhci9saWIvZHBrZy9sb2NrIF0KICAgdGhlbgogICAgICBybSAtZiAvdmFyL2xpYi9kcGtnL2xvY2sKICAgICAgZHBrZyAtLWNvbmZpZ3VyZSAtYQogICBmaQoKICAgZWNobyAiQ2hlY2tpbmcga3ViZXJuZXRlcyB2ZXJzaW9uLi4uIgogICBLOFNWRVI9YGt1YmVsZXQgLS12ZXJzaW9uIDI+L2Rldi9udWxsfCBzZWQgLW4gICdzLy4qdlswLTldLlwoWzAtOV1cK1wpLi9cMS9wJ2AKICAgW1sgJEs4U1ZFUiAtbHQgMTcwIF1dICYmIGVjaG8gIlJlbW92aW5nIGt1YmVybmV0ZXMgdmVyc2lvbiAkSzhTVkVSIG9uIERFQklBTi4uLiIgJiYgYXB0IC0teWVzIHB1cmdlIGt1YmUqCiAgIGFwdCAtLXllcyBpbnN0YWxsIGN1cmwgbHNiLXJlbGVhc2UKICAgaWYgWyAkVkVSU0lPTl9JRCAtZ2UgMTAgXQogICB0aGVuCiAgICAgIGFwdCAtLXllcyBwdXJnZSBpcHRhYmxlcyAmJiBhcHQgLS15ZXMgaW5zdGFsbCBnbnVwZzIKICAgZmkKICAgYXB0LWdldCB1cGRhdGUKICAgY3VybCAtZnNTTCBodHRwczovL2Rvd25sb2FkLmRvY2tlci5jb20vbGludXgvZGViaWFuL2dwZyB8IGFwdC1rZXkgYWRkIC0KICAgY3VybCAtc0wgaHR0cHM6Ly9wYWNrYWdlcy5jbG91ZC5nb29nbGUuY29tL2FwdC9kb2MvYXB0LWtleS5ncGcgfCBhcHQta2V5IGFkZCAtCiAgIGlmIFsgISAtZiAvZXRjL2FwdC9zb3VyY2VzLmxpc3QuZC9kZXZlbDprdWJpYzpsaWJjb250YWluZXJzOnN0YWJsZTpjcmktbzokQ1JJT19WRVJTSU9OLmxpc3QgXQogICB0aGVuCiAgICAgICBlY2hvICJkZWIgaHR0cHM6Ly9kb3dubG9hZC5vcGVuc3VzZS5vcmcvcmVwb3NpdG9yaWVzL2RldmVsOi9rdWJpYzovbGliY29udGFpbmVyczovc3RhYmxlL0RlYmlhbl8ke1ZFUlNJT05fSUR9LyAvInwgdGVlIC9ldGMvYXB0L3NvdXJjZXMubGlzdC5kL2RldmVsOmt1YmljOmxpYmNvbnRhaW5lcnM6c3RhYmxlLmxpc3QKICAgICAgIGN1cmwgLUwgaHR0cHM6Ly9kb3dubG9hZC5vcGVuc3VzZS5vcmcvcmVwb3NpdG9yaWVzL2RldmVsOi9rdWJpYzovbGliY29udGFpbmVyczovc3RhYmxlL0RlYmlhbl8ke1ZFUlNJT05fSUR9L1JlbGVhc2Uua2V5IHwgc3VkbyBhcHQta2V5IGFkZCAtCiAgICAgICBlY2hvICJkZWIgaHR0cDovL2Rvd25sb2FkLm9wZW5zdXNlLm9yZy9yZXBvc2l0b3JpZXMvZGV2ZWw6L2t1YmljOi9saWJjb250YWluZXJzOi9zdGFibGU6L2NyaS1vOi8kQ1JJT19WRVJTSU9OL0RlYmlhbl8ke1ZFUlNJT05fSUR9LyAvInxzdWRvIHRlZSAvZXRjL2FwdC9zb3VyY2VzLmxpc3QuZC9kZXZlbDprdWJpYzpsaWJjb250YWluZXJzOnN0YWJsZTpjcmktbzokQ1JJT19WRVJTSU9OLmxpc3QKICAgICAgIGN1cmwgLUwgaHR0cHM6Ly9kb3dubG9hZC5vcGVuc3VzZS5vcmcvcmVwb3NpdG9yaWVzL2RldmVsOi9rdWJpYzovbGliY29udGFpbmVyczovc3RhYmxlL0RlYmlhbl8ke1ZFUlNJT05fSUR9L1JlbGVhc2Uua2V5IHwgc3VkbyBhcHQta2V5IGFkZCAtCgogICBmaQogICBpZiBbICEgLWYgL2V0Yy9hcHQvc291cmNlcy5saXN0LmQva3ViZXJuZXRlcy5saXN0IF0KICAgdGhlbgogICAgICBjYXQgPDxFT0YgPi9ldGMvYXB0L3NvdXJjZXMubGlzdC5kL2t1YmVybmV0ZXMubGlzdApkZWIgaHR0cDovL2FwdC5rdWJlcm5ldGVzLmlvLyBrdWJlcm5ldGVzLXhlbmlhbCBtYWluCkVPRgogICBmaQogICBjYXNlICIkVkVSU0lPTl9JRCIgaW4KICAgMTApCiAgICAgICBhcHQtZ2V0IHVwZGF0ZSAtdCBidXN0ZXItYmFja3BvcnRzCiAgICAgICA7OwogICAqKSAgYXB0LWdldCB1cGRhdGUgLXEKICAgICAgIDs7CiAgIGVzYWMKICAgYXB0IC0teWVzIGluc3RhbGwgYXB0LXRyYW5zcG9ydC1odHRwcyBjYS1jZXJ0aWZpY2F0ZXMgZ251cGcyIHNvZnR3YXJlLXByb3BlcnRpZXMtY29tbW9uIHNlbGludXgtdXRpbHMgZWJ0YWJsZXMgZXRodG9vbAogICBhcHQtZ2V0IGluc3RhbGwgLS15ZXMgcHl0aG9uMyBweXRob24zLXBpcCBweXRob24zLWRldiBsb2NhbGVzIGJyaWRnZS11dGlscwogICBhcHQtZ2V0IHVwZGF0ZSAtcQogICBhcHQtZ2V0IHVwZ3JhZGUgLXEKICAgYXB0LWdldCBpbnN0YWxsIC15IGxpYmtyYjUtZGV2IGxpYnNxbGl0ZTMtZGV2IHVuaXhvZGJjLWRldgogICBhcHQtZ2V0IGluc3RhbGwgLXkga3ViZWxldCBrdWJlYWRtIGt1YmVjdGwKICAgYXB0LWdldCBpbnN0YWxsIC15IGxpYnNzbC1kZXYKICAgYXB0LWdldCBpbnN0YWxsIC15IGNwcAogICBhcHQtZ2V0IGluc3RhbGwgLS15ZXMgY3JpLW8gY3JpLW8tcnVuYwogICBsb2NhbGUtZ2VuIGVuX1VTLlVURi04CiAgIGV4cG9ydCBLVUJFTEVUX0VYVFJBX0FSR1M9Ii0tY2dyb3VwLWRyaXZlcj1zeXN0ZW1kIC0tY25pLWJpbi1kaXI9L3Vzci9saWIvY25pIgogICBleHBvcnQgS1VCRUFETUFSRz0iLS1jcmktc29ja2V0IC92YXIvcnVuL2NyaW8vY3Jpby5zb2NrIgogICBQSVA9cGlwMwogICBhZGRfY3Jpb19uZXRjb25maWcKICAgc3lzdGVtY3RsIHJlc3RhcnQgY3Jpbwp9CgoKYWRkX2NyaW9fbmV0Y29uZmlnKCkKewogICAKICAgaWYgWyAtZCAvZXRjL2NyaW8vY3Jpby5jb25mLmQgXQogICB0aGVuCgkgICBpZiBbICQoZ3JlcCAiXC9vcHRcL2NuaVwvYmluIiAvZXRjL2NyaW8vY3Jpby5jb25mLmQvKiB8IHdjIC1sKSAtZXEgMCBdCgkgICB0aGVuCgkJIGVjaG8gIkFkZGluZyBjcmlvIG5ldHdvcmsgY29uZmlndXJhdGlvbi4uLiIKCgkJIGVjaG8gLWUgIltjcmlvLm5ldHdvcmtdCm5ldHdvcmtfZGlyID0gXCIvZXRjL2NuaS9uZXQuZC9cIgpwbHVnaW5fZGlycyA9IFsKICAgICAgICBcIi9vcHQvY25pL2Jpbi9cIiwKICAgICAgICBcIi91c3IvbGliZXhlYy9jbmkvXCIsCl0KIiA+IC9ldGMvY3Jpby9jcmlvLmNvbmYuZC8xMC1jcmlvLW5ldHdvcmsuY29uZgogICAgICAgICAgIGVsc2UKCSAgICAgICBlY2hvICJjcmlvIG5ldHdvcmsgaGFzIGJlZW4gY29uZmlndXJlLi4iCgkgICBmaQogICBlbHNlCiAgICAgICAgIG1rZGlyIC1wIC9ldGMvY3Jpby9jcmlvLmNvbmYuZAogICAgICAgICBlY2hvIC1lICJbY3Jpby5uZXR3b3JrXQpuZXR3b3JrX2RpciA9IFwiL2V0Yy9jbmkvbmV0LmQvXCIKcGx1Z2luX2RpcnMgPSBbCiAgICAgICAgXCIvb3B0L2NuaS9iaW4vXCIsCiAgICAgICAgXCIvdXNyL2xpYmV4ZWMvY25pL1wiLApdCiIgPiAvZXRjL2NyaW8vY3Jpby5jb25mLmQvMTAtY3Jpby1uZXR3b3JrLmNvbmYKIAoJIGVjaG8gIkFkZGVkIGNyaW8ubmV0d29yayBpbnRvIC9ldGMvY3Jpby9jcmlvLmNvbmYuZC8xMC1jcmlvLW5ldHdvcmsuY29uZiIKICAgZmkKfQoKaW5zdGFsbF9wa2dfYXJjaGxpbnV4KCkKewogICB3aGlsZSBbWyBgcHMgLWVmIHwgZ3JlcCAicGFjbWFuICIgfCBncmVwIC12IGdyZXAgfCB3YyAtbGAgLW5lIDAgXV0KICAgZG8KICAgICAgZWNobyAiV2FpdGluZyBmb3IgcGFjbWFuIHRvIGZpbmlzaCEhIgogICAgICBzbGVlcCA1CiAgIGRvbmUKICAgW1sgLWYgL3Zhci9saWIvcGFjbWFuL2RiLmxjayBdXSAmJiBybSAtZiAvdmFyL2xpYi9wYWNtYW4vZGIubGNrCiAgIHBhY21hbiAtU3kgYXJjaGxpbnV4LWtleXJpbmcgLS1ub2NvbmZpcm0KICAgcGFjbWFuIC1TeXUgLS1ub2NvbmZpcm0KICAgcGFjbWFuIC1TeSAtLW5vY29uZmlybSBjdXJsIGdpdCBzdWRvIHdnZXQgZWJ0YWJsZXMgZXRodG9vbCB1bnppcCBjb25udHJhY2stdG9vbHMgc29jYXQgY25pLXBsdWdpbnMKICAgcGFjbWFuIC1TeSAtLW5vY29uZmlybSBweXRob24gZmFrZXJvb3QgYmludXRpbHMgbWFrZQogICB3Z2V0IGh0dHBzOi8vYm9vdHN0cmFwLnB5cGEuaW8vZ2V0LXBpcC5weSAtTyAvdG1wL2dldC1waXAucHkKICAgcHl0aG9uIC90bXAvZ2V0LXBpcC5weQogICBwYWNtYW4gLVN5IC0tbm9jb25maXJtIHNxbGl0ZSB1bml4b2RiYyBrcmI1IGdjYwogICBwYWNtYW4gLVNjIC0tbm9jb25maXJtCiAgIFtbIGBncmVwICJnaXQgIiAvZXRjL3N1ZG9lcnMgfCB3YyAtbGAgLWVxIDAgXV0gJiYgZWNobyAiZ2l0IEFMTD0oQUxMKSAgIE5PUEFTU1dEOiBBTEwiID4+IC9ldGMvc3Vkb2VycwogICBzdSAtIGdpdCAtcyAvYmluL2Jhc2ggLWMgIgpjZCAvdG1wCmdpdCBjbG9uZSBodHRwczovL2F1ci5hcmNobGludXgub3JnL2t1YmVybmV0ZXMtY25pLWJpbi5naXQKY2Qga3ViZXJuZXRlcy1jbmktYmluCm1ha2Vwa2cgLXNpIC0tbm9jb25maXJtCmNkIC4uCnJtIC1yZiBrdWJlcm5ldGVzLWNuaS1iaW4KZ2l0IGNsb25lIGh0dHBzOi8vYXVyLmFyY2hsaW51eC5vcmcva3ViZWxldC1iaW4uZ2l0CmNkIGt1YmVsZXQtYmluCm1ha2Vwa2cgLXNpIC0tbm9jb25maXJtCmNkIC4uCnJtIC1yZiBrdWJlbGV0LWJpbgpnaXQgY2xvbmUgaHR0cHM6Ly9hdXIuYXJjaGxpbnV4Lm9yZy9rdWJlYWRtLWJpbi5naXQKY2Qga3ViZWFkbS1iaW4KbWFrZXBrZyAtc2kgLS1ub2NvbmZpcm0KY2QgLi4Kcm0gLXJmIGt1YmVhZG0tYmluCmdpdCBjbG9uZSBodHRwczovL2F1ci5hcmNobGludXgub3JnL2t1YmVjdGwtYmluLmdpdApjZCBrdWJlY3RsLWJpbgptYWtlcGtnIC1zaSAtLW5vY29uZmlybQpjZCAuLgpybSAtcmYga3ViZWN0bC1iaW4KIgogICBwYWNtYW4gLVN5IC0tbm9jb25maXJtIGNyaS1vIGNyaWN0bAogICBleHBvcnQgS1VCRUFETUFSRz0iLS1jcmktc29ja2V0IC92YXIvcnVuL2NyaW8vY3Jpby5zb2NrIgogICBleHBvcnQgS1VCRUxFVF9FWFRSQV9BUkdTPSItLWNuaS1iaW4tZGlyPS9vcHQvY25pL2JpbiAtLWNuaS1jb25mLWRpcj0vZXRjL2NuaS9uZXQuZCIKICAgc3lzdGVtY3RsIHJlc3RhcnQga3ViZWxldAogICBQSVA9cGlwCiAgIGFkZF9jcmlvX25ldGNvbmZpZwoKCgp9CgoKaW5zdGFsbF9wcmVyZXFzKCkKewoKW1sgIiQoZ3JlcCBQUkVSRVFTICRQUk9HUkVTU19GSUxFKSIgPSAiUFJFUkVRUyIgXV0gJiYgZWNobyAtZSAiPj4+Pj4+Pj4+PiBBbGwgcHJlcmVxdWlzaXRlcyBoYXZlIGJlZW4gaW5zdGFsbGVkIS4uIHNraXBwaW5nLi4uXG4iICYmIHJldHVybgojCiMKZWNobyAiIgplY2hvICIjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIgplY2hvICIjIyMjIyMjIyBHYXRoZXJpbmcgTGludXggRGlzdHJvIGFuZCBJbnN0YWxsaW5nIFJlcXVpcmVkIHBhY2thZ2VzICMjIyMjIyMjIgplY2hvICIjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIgoKCgpjYXNlICIkRElTVFJPIiBpbgogICAgIkNFTlRPUyJ8IlJIRUwiKQoJICAgIGluc3RhbGxfcGtnX2NlbnRvcwoJICAgIDs7CgogICAgIlVCVU5UVSIpCgkgICAgaW5zdGFsbF9wa2dfdWJ1bnR1CgkgICAgOzsKICAgICJBUkNIIikKCSAgICBpbnN0YWxsX3BrZ19hcmNobGludXgKCSAgICA7OwogICAgIkRFQklBTiIpIAogICAgICAgICAgICBpbnN0YWxsX3BrZ19kZWJpYW4KICAgICAgICAgICAgOzsKICAgICJTVVNFIikgCiAgICAgICAgICAgIGluc3RhbGxfcGtnX3N1c2UKICAgICAgICAgICAgOzsKZXNhYwoKaWYgWyBgZ3JlcCAkVEhFVVNFUiAvZXRjL3Bhc3N3ZCB8IHdjIC1sYCAtZXEgMCBdCnRoZW4KICAgZWNobyAiQ3JlYXRpbmcgdXNlciAkVEhFVVNFUiAuLi4iCiAgIFtbICEgLWQgL2hvbWUvJFRIRVVTRVIgXV0gJiYgbWtkaXIgLXAgL2hvbWUvJFRIRVVTRVIKICAgdXNlcmFkZCAtZCAvaG9tZS8kVEhFVVNFUiAkVEhFVVNFUgplbHNlCiAgIGVjaG8gIkNoZWNraW5nIHVzZXIgJFRIRVVTRVIgLi4uIgogICBbWyAhIC1kIC9ob21lLyRUSEVVU0VSIF1dICYmIG1rZGlyIC1wIC9ob21lLyRUSEVVU0VSICYmIHVzZXJtb2QgLWQgL2hvbWUvJFRIRVVTRVIgJFRIRVVTRVIKZmkKCltbIGBjYXQgJFBST0dSRVNTX0ZJTEUgfCBncmVwICJVU0VSPSIgfCB3YyAtbGAgLWVxIDAgXV0gJiYgZWNobyAiVVNFUj0ke1RIRVVTRVJ9IiA+PiAkUFJPR1JFU1NfRklMRQpbWyBgZ3JlcCAiJHtUSEVVU0VSfS4qYmFzaCIgL2V0Yy9wYXNzd2QgfCB3YyAtbGAgLWVxIDAgXV0gJiYgdXNlcm1vZCAtcyAvYmluL2Jhc2ggJFRIRVVTRVIKY2hvd24gLVJoICQoZ3JlcCAiXiR7VEhFVVNFUn06IiAvZXRjL3Bhc3N3ZCB8IGN1dCAtZjMtNCAtZCI6IikgL2hvbWUvJHtUSEVVU0VSfQoKIyBTZXQgU0VMaW51eCBpbiBwZXJtaXNzaXZlIG1vZGUgKGVmZmVjdGl2ZWx5IGRpc2FibGluZyBpdCkKZWNobyAiQ2hlY2sgc2VsaW51eCBhbmQgZGlzYWJsZSBpdC4uLi4uIgpTRUxJTlVYRklMRT0vZXRjL3N5c2NvbmZpZy9zZWxpbnV4CndoaWNoIGdldGVuZm9yY2UgMj4vZGV2L251bGwKaWYgWyAkPyAtZXEgMCBdCnRoZW4KICAgW1sgJChnZXRlbmZvcmNlKSA9ICdFbmZvcmNpbmcnIF1dICYmIHNldGVuZm9yY2UgMCAmJiBzZWQgLWkgJ3MvXlNFTElOVVg9ZW5mb3JjaW5nJC9TRUxJTlVYPXBlcm1pc3NpdmUvJyAkU0VMSU5VWEZJTEUKZWxzZQogICBpZiBbIC1mICRTRUxJTlVYRklMRSBdCiAgIHRoZW4KICAgICAgaWYgWyBgc2VkIC1uICdzL15TRUxJTlVYWyA9XVwrXChbWzphbHBoYTpdXVwrXCkuKiQvXDEvcCcgJFNFTElOVVhGSUxFIHwgZWdyZXAgJ2Rpc2FibGVkfHBlcm1pc3NpdmUnIHwgd2MgLWxgIC1uZSAwIF0KICAgICAgdGhlbgogICAgICAgICAgc2V0ZW5mb3JjZSAwIAogICAgICAgICAgc2VkIC1pICdzL15TRUxJTlVYPWVuZm9yY2luZyQvU0VMSU5VWD1wZXJtaXNzaXZlLycgJFNFTElOVVhGSUxFCiAgICAgIGZpCiAgIGZpCmZpCgplY2hvICJQYWNrYWdlcyBpbnN0YWxsZWQuIgoKIyBMb2FkIGFsbCBwcmUtcmVxdWlzaXRlcyBmb3IgS3ViZXJuZXRlcy4KIwplY2hvICIjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIgplY2hvICIjIyMjIyMjIyMjIyMjIyBTZXR0aW5nIHVwIHByZS1yZXF1aXNpdGVzIGZvciBLdWJlcm5ldGVzICMjIyMjIyMjIyMjIyMjIyMjIgplY2hvICIjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIgoKW1sgJChncmVwICQoaG9zdG5hbWUpIC9ldGMvaG9zdHMgfCB3YyAtbCkgLWVxIDAgXV0gJiYgZWNobyAiJChob3N0bmFtZSAtaSkgJChob3N0bmFtZSkiID4+IC9ldGMvaG9zdHMKCmVjaG8gIlN3YXAgbXVzdCBiZSB0dXJuZWQgb2ZmIGFuZCBtb2RpZnkgL2V0Yy9mc3RhYiB0byBleGNsdWRlIHN3YXAiCnN3YXBvZmYgLWEKc2VkIC1pICcvc3dhcC9zL15cKC4qXCkkLyNcMS9nJyAvZXRjL2ZzdGFiCgoKZWNobyAiRW5hYmxpbmcga3ViZWxldCBvbiBzeXN0ZW1kLi4uIgpzeXN0ZW1jdGwgZW5hYmxlIGt1YmVsZXQKCiMgSG9sZGluZyB0aGUgdmVyc2lvbiBvZiBrdWJlIHBhY2thZ2VzLgojCmVjaG8gIkRvd25sb2FkaW5nIGhlbG0uLi4iCmN1cmwgaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2t1YmVybmV0ZXMvaGVsbS9tYXN0ZXIvc2NyaXB0cy9nZXQgfCBiYXNoCgplY2hvIC1lICJvdmVybGF5XG5icl9uZXRmaWx0ZXIiID4gL2V0Yy9tb2R1bGVzLWxvYWQuZC9jb250YWluZXJkLmNvbmYKbW9kcHJvYmUgYnJfbmV0ZmlsdGVyCm1vZHByb2JlIG92ZXJsYXkKCiMgRGlzYWJsZSBJcHY2IGZvciBjbHVzdGVyIGVuZHBvaW50cy4KIwplY2hvICJBZGRpbmcgbmVjZXNzYXJ5IGtlcm5lbCBwYXJhbWV0ZXJzIHRvIC9ldGMvc3lzY3RsLmNvbmYuLi4iCmVjaG8gbmV0LmlwdjYuY29uZi5hbGwuZGlzYWJsZV9pcHY2PTEgPiAvZXRjL3N5c2N0bC5jb25mCmVjaG8gbmV0LmlwdjYuY29uZi5kZWZhdWx0LmRpc2FibGVfaXB2Nj0xID4+IC9ldGMvc3lzY3RsLmNvbmYKZWNobyBuZXQuaXB2Ni5jb25mLmxvLmRpc2FibGVfaXB2Nj0xID4+IC9ldGMvc3lzY3RsLmNvbmYKZWNobyBuZXQuYnJpZGdlLmJyaWRnZS1uZi1jYWxsLWlwdGFibGVzPTEgPj4gL2V0Yy9zeXNjdGwuY29uZgplY2hvIG5ldC5pcHY0LmlwX2ZvcndhcmQ9MSA+PiAvZXRjL3N5c2N0bC5jb25mCmVjaG8gbmV0LmJyaWRnZS5icmlkZ2UtbmYtY2FsbC1pcDZ0YWJsZXM9MSA+PiAvZXRjL3N5c2N0bC5jb25mCgoKZWNobyAiQWN0aXZhdGluZyBrZXJuZWwgcGFyYW1ldGVycy4uLiIKc3lzY3RsIC0tc3lzdGVtCgplY2hvICJLdWJlcm5ldGVzIHByZS1yZXF1aXNpdGVzIGhhdmUgYmVlbiBjb21wbGV0ZWQuIgplY2hvIFBSRVJFUVMgPj4gJFBST0dSRVNTX0ZJTEUKfQoKaW5zdGFsbF9jYWxpY29fbmZ0YWJsZXMoKQp7CiAgICB3Z2V0IC1PIC90bXAvY2FsaWNvLnlhbWwgJENBTElDTwogICAgc2VkIC1pICc6YTtOOyQhYmE7cy8jIERpc2FibGUgSVB2NiBvbiBLdWJlcm5ldGVzLlxuLyMgQWRkZWQgYnkgc2V0dXAtazhzIGZvciBuZnR0YWJsZVxuICAgICAgICAgICAgLSBuYW1lOiBGRUxJWF9JUFRBQkxFU0JBQ0tFTkRcbiAgICAgICAgICAgICAgdmFsdWU6ICJBdXRvIlxuL2cnIC90bXAvY2FsaWNvLnlhbWwKICAgIGVjaG8gIkluc3RhbGxpbmcgY2FsaWNvIG5mdGFibGVzIgogICAga3ViZWN0bCAtLWt1YmVjb25maWc9L2V0Yy9rdWJlcm5ldGVzL2FkbWluLmNvbmYgYXBwbHkgLWYgL3RtcC9jYWxpY28ueWFtbAp9CgoKaW5zdGFsbF9uZXR3b3JrKCkKewplY2hvICIjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIgplY2hvICIjIyMjIyMjIyMjIyMjIyMjIyMjIyMgIEluc3RhbGxpbmcgTmV0d29yayBwbHVnaW4gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIgplY2hvICIjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIgogICBlY2hvICJJbnN0YWxsaW5nIENOSSBwbHVnaW4uLi4uIgogICBjYXNlICIkRElTVFJPIiBpbiAKICAgJ0RFQklBTicpCgkgICBpZiBbICIkVkVSU0lPTl9JRCIgLWdlICIxMCIgXSAKICAgICAgICAgICB0aGVuCiAgICAgICAgICAgICAgICNlY2hvICJUaGlzIGxpbnV4IHZlcnNpb24gdXNlcyBuZnRhYmxlcywgdGhlcmVmb3JlIGNhbGljbyBwbHVnaW4gbXVzdCBiZSB1c2VkISIgCiAgICAgICAgICAgICAgICNpbnN0YWxsX2NhbGljb19uZnRhYmxlcwogICAgICAgICAgICAgICB1cGRhdGUtYWx0ZXJuYXRpdmVzIC0tc2V0IGlwdGFibGVzIC91c3Ivc2Jpbi9pcHRhYmxlcy1sZWdhY3kKICAgICAgICAgICAgICAgdXBkYXRlLWFsdGVybmF0aXZlcyAtLXNldCBpcDZ0YWJsZXMgL3Vzci9zYmluL2lwNnRhYmxlcy1sZWdhY3kKICAgICAgICAgICAgICAgW1sgLWYgL3Vzci9zYmluL2FycHRhYmxlcy1sZWdhY3kgXV0gJiYgdXBkYXRlLWFsdGVybmF0aXZlcyAtLXNldCBhcnB0YWJsZXMgL3Vzci9zYmluL2FycHRhYmxlcy1sZWdhY3kKICAgICAgICAgICAgICAgdXBkYXRlLWFsdGVybmF0aXZlcyAtLXNldCBlYnRhYmxlcyAvdXNyL3NiaW4vZWJ0YWJsZXMtbGVnYWN5CiAgICAgICAgICAgICAgICNyZXR1cm4KICAgICAgICAgICBmaQogICAgICAgICAgIDs7CiAgICdDRU5UT1MnfCdSSEVMJykKCSAgIFtbICIkVkVSU0lPTl9JRCIgLWdlICI4IiBdXSAmJiBlY2hvICJUaGlzIGxpbnV4IHZlcnNpb24gdXNlcyBuZnRhYmxlcy4uLi4uLi4uLi4uLi4uLi4iCiAgICAgICAgICAgOzsKICAgKikKCSAgIGVjaG8gIlVzaW5nIG5ldHdvcmsgcGx1Z2luICRDTklQTFVHSU4iCiAgICAgICAgICAgOzsKICAgZXNhYwogICBbWyAiJENOSVBMVUdJTiIgPSAiV0VBVkVORVQiIF1dICYmIENOSVBMVUdJTj0iaHR0cHM6Ly9jbG91ZC53ZWF2ZS53b3Jrcy9rOHMvbmV0P2s4cy12ZXJzaW9uPSQoa3ViZWN0bCAtLWt1YmVjb25maWcgL2V0Yy9rdWJlcm5ldGVzL2FkbWluLmNvbmYgdmVyc2lvbiB8IGJhc2U2NCB8IHRyIC1kICdcbicpIiAmJiAvdXNyL2xvY2FsL2Jpbi93ZWF2ZSByZXNldAogICBbWyAtZiAvdG1wL3dlYXZlIF1dICYmIC90bXAvd2VhdmUgcmVzZXQgJiYgcm0gLWYgL3RtcC93ZWF2ZQogICBrdWJlY3RsIC0ta3ViZWNvbmZpZz0vZXRjL2t1YmVybmV0ZXMvYWRtaW4uY29uZiBhcHBseSAtZiAkQ05JUExVR0lOCgp9CgpzZXR1cF9rOHMoKQp7CltbICIkKGdyZXAgU0VUVVBLOFMgJFBST0dSRVNTX0ZJTEUpIiA9ICJTRVRVUEs4UyIgXV0gJiYgZWNobyAtZSAiPj4+Pj4+Pj4+PiBLdWJlcm5ldGVzIGhhcyBiZWVuIGluc3RhbGxlZCEuLiBza2lwcGluZy4uLlxuIiAmJiByZXR1cm4KZWNobyAiIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyIKZWNobyAiIyMjIyMjIyMjIyMjIyMjIyMjIyAgU2V0dGluZyB1cCBLdWJlcm5ldGVzICRUSEVOT0RFICAjIyMjIyMjIyMjIyMjIyMjIyMjIyIKZWNobyAiIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyIKCgppZiBbICIkTU9ERSIgPSAiYWRkLXdvcmtlciIgXQp0aGVuCiAgIENVUlJIT1NUPSQoa3ViZWN0bCBnZXQgbm9kZXMgLS1uby1oZWFkZXJzPXRydWUgLS1vdXRwdXQ9Y3VzdG9tLWNvbHVtbnM9TkFNRToubWV0YWRhdGEubmFtZSBgaG9zdG5hbWVgIDI+L2Rldi9udWxsIDE+L2Rldi9udWxsKQogICBbWyAiJENVUlJIT1NUIiAhPSAiIiBdXSAmJiBrdWJlY3RsIGRlbGV0ZSBub2RlICRDVVJSSE9TVApmaQoKaWYgWyBgcHMgLWVmIHwgZ3JlcCAiYmluL2t1YmVsZXQiIHwgZ3JlcCAtdiBncmVwIHwgd2MgLWxgIC1ndCAwIF0KdGhlbgogICBLVUJFUElEPWBwcyAtZW8gcGlkLGNtZCB8IGdyZXAgImJpbi9rdWJlbGV0IiB8IGdyZXAgLXYgZ3JlcCB8IGF3ayAne3ByaW50ICQxfSdgCiAgIFtbICIkS1VCRVBJRCIgIT0gIiIgXV0gJiYgZWNobyAiS2lsbGluZyBrdWJlbGV0Li4uIiAmJiBzeXN0ZW1jdGwgc3RvcCBrdWJlbGV0ICYmIGtpbGwgLTkgJEtVQkVQSUQgMj4vZGV2L251bGwgMT4vZGV2L251bGwKZmkKCmlmIChbIGBwcyAtZWYgfCBncmVwICJiaW4va3ViZWxldCIgfCBncmVwIC12IGdyZXAgfCB3YyAtbGAgLWx0IDIgXSAmJiAoWyAiJE1PREUiID0gInJlc2V0LW1hc3RlciIgXSB8fCBbICIkTU9ERSIgPSAicmVzZXQtc2luZ2xlIiBdKSkgfHwgKFsgIiRNT0RFIiA9ICJhZGQtd29ya2VyIiBdIHx8IFsgIiRNT0RFIiA9ICJyZXNldC13b3JrZXIiIF0pCnRoZW4KICAgS1VCRVBJRD1gcHMgLWVvIHBpZCxjbWQgfCBncmVwICJiaW4va3ViZWxldCIgfCBncmVwIC12IGdyZXAgfCBhd2sgJ3twcmludCAkMX0nYAogICBbWyAiJEtVQkVQSUQiICE9ICIiIF1dICYmIGVjaG8gIktpbGxpbmcga3ViZWxldC4uLiIgJiYgc3lzdGVtY3RsIHN0b3Aga3ViZWxldCAmJiBraWxsIC05ICRLVUJFUElEIDI+L2Rldi9udWxsIDE+L2Rldi9udWxsCiAgIGt1YmVhZG0gcmVzZXQgJHtLVUJFQURNQVJHfSAtZiA8PEVPRgp5CkVPRgoKaWYgWyBgcHMgLWVmIHwgZ3JlcCAiYmluL2NyaW8iIHwgZ3JlcCAtdiBncmVwIHwgd2MgLWxgIC1ndCAwIF0KdGhlbgogICBmb3IgQ09OVEFJTkVSRFBJRCBpbiBgcHMgLWVvIHBpZCxjbWQgfCBncmVwICJiaW4vY3JpbyIgfCBncmVwIC12IGdyZXAgfCBhd2sgJ3twcmludCAkMX0nYAogICBkbwogICAgICBlY2hvICJLaWxsaW5nIGNyaW8uLi4iICYmIHN5c3RlbWN0bCBzdG9wIGNyaW8gJiYga2lsbCAtOSAkQ09OVEFJTkVSRFBJRCAyPi9kZXYvbnVsbCAxPi9kZXYvbnVsbAogICBkb25lCiAgIHN5c3RlbWN0bCByZXN0YXJ0IGNyaW8KICAgZm9yIENPTlRBSU5FUkRQSUQgaW4gYHBzIC1lbyBwaWQsY21kIHwgZ3JlcCAiYmluL2Nvbm1vbiIgfCBncmVwIC12IGdyZXAgfCBhd2sgJ3twcmludCAkMX0nYAogICBkbwogICAgICBlY2hvICJLaWxsaW5nIGNvbm1vbi4uLiIgJiYga2lsbCAtOSAkQ09OVEFJTkVSRFBJRCAyPi9kZXYvbnVsbCAxPi9kZXYvbnVsbAogICBkb25lCmZpCiAgIGlwdGFibGVzIC1GICYmIGlwdGFibGVzIC10IG5hdCAtRiAmJiBpcHRhYmxlcyAtdCBtYW5nbGUgLUYgJiYgaXB0YWJsZXMgLVgKICAgd2hpY2ggbmZ0CiAgIFtbICQ/IC1lcSAwIF1dICYmIG5mdCBmbHVzaCBydWxlc2V0CiAgIGZvciBNTlRQT0lOVCBpbiBgZGYgLS1vdXRwdXQ9dGFyZ2V0IHwgZWdyZXAgImt1YmVsZXQiYAogICBkbwogICAgICAgdW1vdW50ICRNTlRQT0lOVAogICBkb25lCgogICByZXNldF9rdWJlYWRtCiAgIGRlbGV0ZV9lcGhlbWVyYWxfZGlza3MKICAgCiAgIGlmIFsgIiRLVUJFU1RPUkFHRSIgIT0gIi92YXIvbGliL2t1YmVsZXQiIF0KICAgdGhlbgogICAgICBlY2hvICJSZWxvY2F0aW5nIC92YXIvbGliL2t1YmVsZXQgdG8gJEtVQkVTVE9SQUdFIC4uLi4iIAogICAgICBbWyAtZCAvdmFyL2xpYi9rdWJlbGV0IF1dICYmIHJtIC1yZiAvdmFyL2xpYi9rdWJlbGV0CiAgICAgIG1rZGlyIC1wICRLVUJFU1RPUkFHRQogICAgICBbWyAkPyAtbmUgMCBdXSAmJiBlY2hvICJGYWlsZWQgdG8gY3JlYXRlICRLVUJFU1RPUkFHRSwgZXhpdGluZy4uLiIgJiYgZXhpdCAxCiAgICAgIGxuIC1zICRLVUJFU1RPUkFHRSAvdmFyL2xpYi9rdWJlbGV0CiAgIGZpCgoKICAgaWYgWyAiJENPTlRBSU5FUlNUT1JBR0UiICE9ICIvdmFyL2xpYi9jb250YWluZXJzIiBdCiAgIHRoZW4KICAgICAgZWNobyAiUmVsb2NhdGluZyAvdmFyL2xpYi9jb250YWluZXJzIHRvICRDT05UQUlORVJTVE9SQUdFIC4uLi4iIAogICAgICBbWyAtZCAvdmFyL2xpYi9jb250YWluZXJzIF1dICYmIHJtIC1yZiAvdmFyL2xpYi9jb250YWluZXJzCiAgICAgIG1rZGlyIC1wICRDT05UQUlORVJTVE9SQUdFCiAgICAgIFtbICQ/IC1uZSAwIF1dICYmIGVjaG8gIkZhaWxlZCB0byBjcmVhdGUgJENPTlRBSU5FUlNUT1JBR0UsIGV4aXRpbmcuLi4iICYmIGV4aXQgMQogICAgICBsbiAtcyAkQ09OVEFJTkVSU1RPUkFHRSAvdmFyL2xpYi9jb250YWluZXJzCiAgIGZpCgogICBzeXN0ZW1jdGwgcmVzdGFydCBjcmlvCiAgIGlmIFsgIiQoZWNobyAkTU9ERSB8IGdyZXAgd29ya2VyIHwgY3V0IC1mMiAtZCctJykiID0gIndvcmtlciIgXQogICB0aGVuCiAgICAgIGVjaG8gIkpvaW5pbmcgY2x1c3Rlci4uLi4iCiAgICAgIGVjaG8gIkV4ZWN1dGluZyBjb21tYW5kICRLVUJFQURNX0pPSU5fQ01EICRLVUJFQURNQVJHIC4uLi4uLi4uLi4uLi4uLi4uLi4uIgogICAgICBzbGVlcCA1CiAgICAgICRLVUJFQURNX0pPSU5fQ01EICRLVUJFQURNQVJHCiAgICAgIFtbICEgLWQgL2hvbWUvJFRIRVVTRVIvLmt1YmUgXV0gJiYgbWtkaXIgLXAgL2hvbWUvJFRIRVVTRVIvLmt1YmUKICAgICAgTUFTVEVSTk9ERT1gZWNobyAkS1VCRUFETV9KT0lOX0NNRCAkS1VCRUFETUFSRyB8IGF3ayAne3ByaW50ICQzfScgfCBjdXQgLWYxIC1kJzonYAogICAgICBzY3AgJHtNQVNURVJOT0RFfTovZXRjL2t1YmVybmV0ZXMvYWRtaW4uY29uZiAvaG9tZS8ke1RIRVVTRVJ9Ly5rdWJlL2NvbmZpZwogICAgICBbWyAtZCAvZXRjL2t1YmVybmV0ZXMgXV0gJiYgW1sgLWYgL2hvbWUvJFRIRVVTRVIvLmt1YmUvY29uZmlnIF1dICYmIGNwIC9ob21lLyR7VEhFVVNFUn0vLmt1YmUvY29uZmlnIC9ldGMva3ViZXJuZXRlcy9hZG1pbi5jb25mCiAgICAgIGNob3duIC1SaCAkKGdyZXAgIl4ke1RIRVVTRVJ9OiIgL2V0Yy9wYXNzd2QgfCBjdXQgLWYzLTQgLWQiOiIpIC9ob21lLyR7VEhFVVNFUn0KICAgZWxpZiBbICIkKGVjaG8gJE1PREUgfCBncmVwIG1hc3RlciB8IGN1dCAtZjIgLWQnLScpIiA9ICJtYXN0ZXIiIC1vICIkKGVjaG8gJE1PREUgfCBncmVwIHNpbmdsZSB8IGN1dCAtZjIgLWQnLScpIiA9ICJzaW5nbGUiIF0KICAgdGhlbgogICAgICBlY2hvICJJbml0aWFsaXppbmcgbWFzdGVyL3NpbmdsZSBub2RlLi4uLiIKICAgICAgZWNobyAiRXhlY3V0aW5nIGt1YmVhZG0gaW5pdCAkS1VCRVBBUkFNSU5JVCAkS1VCRUFETUFSRyIKICAgICAgc2V0IC14CiAgICAgIHBzIC1lZiB8IGdyZXAgY29udGFpbmVyCiAgICAgIGt1YmVhZG0gaW5pdCAke0tVQkVQQVJBTUlOSVR9ICR7S1VCRUFETUFSR30KICAgICAgW1sgISAtZCAvaG9tZS8kVEhFVVNFUi8ua3ViZSBdXSAmJiBta2RpciAtcCAvaG9tZS8kVEhFVVNFUi8ua3ViZQogICAgCiAgICAgIGNwIC1mIC9ldGMva3ViZXJuZXRlcy9hZG1pbi5jb25mIC9ob21lLyRUSEVVU0VSLy5rdWJlL2NvbmZpZwogICAgICBjaG93biAtUmggJChncmVwICJeJHtUSEVVU0VSfToiIC9ldGMvcGFzc3dkIHwgY3V0IC1mMy00IC1kIjoiKSAvaG9tZS8ke1RIRVVTRVJ9CiAgICAgIGluc3RhbGxfbmV0d29yawogICAgICBzZXQgK3gKICAgZWxzZQogICAgICBlY2hvICJSZXN1bWluZy4uLi4uLi4uLi4uLi4uLi4uLi4uIgogICBmaQplbHNlCiAgIGVjaG8gIlVzaW5nIGN1cnJlbnQgY29uZmlndXJhdGlvbi4uLi4uLi4uLi4iCmZpCgojIFRvIGVuYWJsZSBhIHNpbmdsZSBub2RlIGNsdXN0ZXIgcmVtb3ZlIHRoZSB0YWludCB0aGF0IGxpbWl0cyB0aGUgZmlyc3Qgbm9kZSB0byBtYXN0ZXIgb25seSBzZXJ2aWNlLgojCmVjaG8gU0VUVVBLOFMgPj4gJFBST0dSRVNTX0ZJTEUKfQoKdW50YWludF9tYXN0ZXJfbm9kZSgpCnsKZWNobyAtZSAiXG5Vbi10YWludCBtYXN0ZXIgbm9kZS4uLi4uLlxuIgpzdSAtICRUSEVVU0VSIC1jICIKbWFzdGVyX25vZGU9XGBrdWJlY3RsIGdldCBub2RlcyAtLW5vLWhlYWRlcnM9dHJ1ZSAtLW91dHB1dD1jdXN0b20tY29sdW1ucz1OQU1FOi5tZXRhZGF0YS5uYW1lXGAKa3ViZWN0bCB0YWludCBub2RlcyBcJHttYXN0ZXJfbm9kZX0gbm9kZS1yb2xlLmt1YmVybmV0ZXMuaW8vbWFzdGVyOk5vU2NoZWR1bGUtIDI+L2Rldi9udWxsIAoiCn0KCnNldHVwX2xvY2FsX2Rpc2soKQp7CltbICIkKGdyZXAgU0VUVVBMT0NBTERJU0sgJFBST0dSRVNTX0ZJTEUpIiA9ICJTRVRVUExPQ0FMRElTSyIgXV0gJiYgZWNobyAtZSAiPj4+Pj4+Pj4+PiBMb2NhbCBkaXNrIHN0b3JhZ2UgaGFzIGJlZW4gY3JlYXRlZCAhLi4gc2tpcHBpbmcuLi5cbiIgJiYgcmV0dXJuCmVjaG8gLWUgIlxuU2V0dGluZyB1cCBsb2NhbCBkaXNrIHN0b3JhZ2UuLi4uLlxuIgoKIyBTZXR0aW5nIHVwIHRoZSBwZXJzaXN0ZW50IHZvbHVtZXMgZm9yIHRoZSBrdWJlcm5ldGVzLgplY2hvICIjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIgplY2hvICIjIyMjIyMjIyMjIyMjIyAgU2V0dGluZyB1cCBsb2NhbCBkaXNrIGZvciBwZXJzaXN0ZW50IHZvbHVtZSAjIyMjIyMjIyMjIyMjIgplY2hvICIjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIgplY2hvICJDcmVhdGluZyBsb2NhbCBwZXJzaXN0ZW50IHZvbHVtZXMgdW5kZXIgZGlyZWN0b3J5ICR7TE9DQUxTVE9SQUdFfS4uLiIKZm9yIGkgaW4gJChzZXEgMSAkUFZfQ09VTlQpOyBkbwoKICB2b2w9InZvbCRpIgogIFtbICEgLWQgJHtMT0NBTFNUT1JBR0V9LyR2b2wgXV0gJiYgbWtkaXIgLXAgJHtMT0NBTFNUT1JBR0V9LyR2b2wKICBbWyAiJChkZiAke0xPQ0FMU1RPUkFHRX0vJHZvbCB8IGF3ayAne3ByaW50ICRORn0nIHwgc2VkIDFkKSIgPSAiJHtMT0NBTFNUT1JBR0V9LyR2b2wiIF1dICYmIHVtb3VudCAke0xPQ0FMU1RPUkFHRX0vJHZvbCAmJiBybSAtcmYgJHtMT0NBTFNUT1JBR0V9LyR2b2wvKgoKICBtb3VudCAtLWJpbmQgJHtMT0NBTFNUT1JBR0V9LyR2b2wgJHtMT0NBTFNUT1JBR0V9LyR2b2wKICBbWyAkPyAtbmUgMCBdXSAmJiBlY2hvICJFcnJvcjogbW91bnRpbmcgbG9jYWwtc3RvcmFnZS4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4iICYmIGV4aXQgMQoKZG9uZQoKW1sgLWYgL3RtcC9sb2NhbC1zdG9yYWdlLXByb3Zpc2lvbmVyLnlhbWwgXV0gJiYgY2hvd24gJFRIRVVTRVIgL3RtcC9sb2NhbC1zdG9yYWdlLXByb3Zpc2lvbmVyLnlhbWwKCnN1IC0gJFRIRVVTRVIgLWMgIgoKd2dldCBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vbWljcm9zb2Z0L3NxbC1zZXJ2ZXItc2FtcGxlcy9tYXN0ZXIvc2FtcGxlcy9mZWF0dXJlcy9zcWwtYmlnLWRhdGEtY2x1c3Rlci9kZXBsb3ltZW50L2t1YmVhZG0vdWJ1bnR1L2xvY2FsLXN0b3JhZ2UtcHJvdmlzaW9uZXIueWFtbCAtTyAvdG1wL2xvY2FsLXN0b3JhZ2UtcHJvdmlzaW9uZXIueWFtbAoKaWYgWyAtZiAvdG1wL2xvY2FsLXN0b3JhZ2UtcHJvdmlzaW9uZXIueWFtbCBdCnRoZW4KICAgZWNobyBcIk1vZGlmeWluZyBmaWxlIGxvY2FsLXN0b3JhZ2UtcHJvdmlzaW9uZXIueWFtbFwiCiAgIFRIRU1PVU5UPVxgZ3JlcCBtb3VudERpciAvdG1wL2xvY2FsLXN0b3JhZ2UtcHJvdmlzaW9uZXIueWFtbCB8IGF3ayAne3ByaW50IFwkMn0nIHwgc2VkICdzL1wvL1xcXFxcXFxcXC8vZydcYAogICBUSEVTVE9SQUdFPVxgZWNobyAke0xPQ0FMU1RPUkFHRX0gfCBzZWQgJ3MvXC8vXFxcXFxcXFxcLy9nJ1xgCiAgIGVjaG8gXCJSZXBsYWNpbmcgXCRUSEVNT1VOVCB3aXRoIFwkVEhFU1RPUkFHRSAuLi4uLlwiCiAgIHNlZCAtaSBcInMvXCR7VEhFTU9VTlR9L1wke1RIRVNUT1JBR0V9L2dcIiAvdG1wL2xvY2FsLXN0b3JhZ2UtcHJvdmlzaW9uZXIueWFtbAogICBrdWJlY3RsIGFwcGx5IC1mIC90bXAvbG9jYWwtc3RvcmFnZS1wcm92aXNpb25lci55YW1sCiAgIHJtIC1mIC90bXAvbG9jYWwtc3RvcmFnZS1wcm92aXNpb25lci55YW1sCmZpCmhlbG0gaW5pdAoiCgplY2hvIFNFVFVQTE9DQUxESVNLID4+ICRQUk9HUkVTU19GSUxFCn0KCgppc19jbHVzdGVyX3JlYWR5KCkKewojIFZlcmlmeSB0aGF0IHRoZSBjbHVzdGVyIGlzIHJlYWR5IHRvIGJlIHVzZWQuCiMKc3UgLSAkVEhFVVNFUiAtYyAiClRJTUVPVVQ9JHtUSU1FT1VUfQplY2hvIFwiVmVyaWZ5aW5nIHRoYXQgdGhlIGNsdXN0ZXIgaXMgcmVhZHkgZm9yIHVzZS4uLlwiCndoaWxlIHRydWUgOyBkbwogICAgaWYgWyBcJFRJTUVPVVQgLWxlIDAgXQogICAgdGhlbgogICAgICAgIGVjaG8gXCJDbHVzdGVyIG5vZGUgZmFpbGVkIHRvIHJlYWNoIHRoZSAnUmVhZHknIHN0YXRlLiBLdWJlYWRtIHNldHVwIGZhaWxlZC5cIgogICAgICAgIGV4aXQgMQogICAgZmkKCiAgICBTVEFUPVxga3ViZWN0bCBnZXQgbm9kZXMgLS1uby1oZWFkZXJzPXRydWUgfCBlZ3JlcCBcIiQoaG9zdG5hbWUgLXMpIHwkKGhvc3RuYW1lIC1mKSBcIiB8IGF3ayAne3ByaW50IFwkMn0nXGAKCiAgICBpZiBbIFwiXCRTVEFUXCIgPSBcIlJlYWR5XCIgXTsgdGhlbgogICAgICAgIGJyZWFrCiAgICBmaQoKICAgIHNsZWVwICRSRVRSWV9JTlRFUlZBTAoKICAgIFRJTUVPVVQ9XCQoKFwkVElNRU9VVC0kUkVUUllfSU5URVJWQUwpKQoKICAgIGVjaG8gXCJDbHVzdGVyIG5vdCByZWFkeS4gUmV0cnlpbmcuLi5cIgpkb25lCiIKfQoKaW5zdGFsbF9rOHNfZGFzaGJvYXJkKCkKewoKW1sgIiQoZ3JlcCBLOFNEQVNIQk9BUkQgJFBST0dSRVNTX0ZJTEUpIiA9ICJLOFNEQVNIQk9BUkQiIF1dICYmIGVjaG8gLWUgIj4+Pj4+Pj4+Pj4gS3ViZXJuZXRlcyBkYXNoYm9hcmQgaGFzIGJlZW4gaW5zdGFsbGVkIS4uIHNraXBwaW5nLi4uXG4iICYmIHJldHVybgoKIyBJbnN0YWxsIHRoZSBkYXNoYm9hcmQgZm9yIEt1YmVybmV0ZXMuCiMKc3UgLSAkVEhFVVNFUiAtYyAiCmt1YmVjdGwgYXBwbHkgLWYgJERBU0hCT0FSRAoja3ViZWN0bCBjcmVhdGUgY2x1c3RlcnJvbGViaW5kaW5nIGt1YmVybmV0ZXMtZGFzaGJvYXJkIC0tY2x1c3RlcnJvbGU9Y2x1c3Rlci1hZG1pbiAtLXNlcnZpY2VhY2NvdW50PWt1YmUtc3lzdGVtOmt1YmVybmV0ZXMtZGFzaGJvYXJkCmVjaG8gXCJLdWJlcm5ldGVzIG1hc3RlciBzZXR1cCBkb25lLlwiCiIKZWNobyBLOFNEQVNIQk9BUkQgPj4gJFBST0dSRVNTX0ZJTEUKfQoKa2lsbF9rdWJlbGV0X2FuZF9rOHMoKQp7CiAgIGVjaG8gIkNoZWNraW5nIHdoZXRoZXIga3ViZWxldCBpcyBydW5uaW5nLi4uIgogICBbWyBgcHMgLWVmIHwgZ3JlcCAiYmluL2t1YmVsZXQiIHwgZ3JlcCAtdiBncmVwIHwgd2MgLWxgIC1uZSAwIF1dICYmIGVjaG8gIlN0b3BwaW5nIGt1YmVsZXQuLi4iICYmIHN5c3RlbWN0bCBzdG9wIGt1YmVsZXQKICAgTVlQSUQ9JCQKICAgZm9yIGxpc3Rwcm9jIGluIGBwcyAtZWYgfCBlZ3JlcCAia3ViZWxldHxjcmlvIiB8IGdyZXAgLXYgIiRNWVBJRCAiIHwgYXdrICd7cHJpbnQgJDJ9J2AKICAgZG8KICAgICAga2lsbCAtOSAkbGlzdHByb2MgMj4vZGV2L251bGxsIDE+L2Rldi9udWxsCiAgIGRvbmUKfQoKI3RoaXMgaXMgaG93IHRvIHVzZSB0aGlzIHNjcmlwdAp1c2FnZV9rOHMoKQp7CiAgIGVjaG8gLWUgIlxuVXNhZ2U6IFxuICAgICQwIC1tIDxtb2RlPiAtdSA8azhzX3VzZXI+IC1sIDxsb2NhbF9zdG9yYWdlX3BhdGg+IC1rIDxrdWJlbGV0X3N0b3JhZ2U+IC1jIDxjb250YWluZXJfc3RvcmFnZT4gLXMgPHN0b3JhZ2VfY2xhc3M+IC1uIDxuZXR3b3JrLXBsdWdpbj4iCiAgIGVjaG8gLWUgIlxuICAgIC1tIG1vZGUgW3Jlc2V0LWFsbHxkZXN0cm95LWFsbHxyZXNldC1zaW5nbGV8cmVzZXQtbWFzdGVyfHJlc2V0LXdvcmtlcnxzaW5nbGV8JycoZGVmYXVsdCldXG4gICAgLXUgazhzLXVzZXIgW2FueS1uYW1lfGs4cyhkZWZhdWx0KV0iCiAgIGVjaG8gLWUgIlxuICAgIC1sIGxvY2FsLXN0b3JhZ2UgW2FueS1tb3VudHBvaW50fC9tbnQvbG9jYWwtc3RvcmFnZShkZWZhdWx0KV1cbiAgICAtayBrdWJlbGV0LXN0b3JhZ2UgW2FueS1tb3VudHBvaW50fC92YXIvbGliL2t1YmVsZXQoZGVmYXVsdCldIgogICBlY2hvIC1lICJcbiAgICAtYyBjb250YWluZXItc3RvcmFnZSBbYW55LW1vdW50cG9pbnR8L3Zhci9saWIvY29udGFpbmVycyhkZWZhdWx0KV1cbiAgICAtcyBzdG9yYWdlY2xhc3MgW2FueS1zdG9yYWdlY2xhc3N8bG9jYWwtc3RvcmFnZV0iCiAgIGVjaG8gLWUgIlxuICAgIC1uIG5ldHdvcmsgW2YgZmxhbm5lbHxjIGNhbGljbyhkZWZhdWx0KV0iCiAgIGVjaG8gLWUgIiAgICBFLmc6ICQwIC1tIHJlc2V0LXNpbmdsZSAtdSBrdWJlIC1sIC9vcHQvbG9jYWwtc3RvcmFnZSAtayAvb3B0L2t1YmVsZXQgLWMgL29wdC9jb250YWluZXJzIC1uIGYiCiAgIGVjaG8gLWUgIiAgICAgICAgICQwIC1tIHJlc2V0LW1hc3RlciAtdSBrdWJlIC1sIC9vcHQvbG9jYWwtc3RvcmFnZSAtYyAvb3B0L2NvbnRhaW5lcnMgLXMgY3NpLXJiZC1jZXBoICN1c2luZyBzdG9yYWdlY2xhc3MgY3NpLXJiZC1jZXBoIGFuZCBjYWxpY28gbmV0d29yayhkZWZhdWx0KSIKICAgZWNobyAtZSAiICAgICAgICAgJDAgLW0gcmVzZXQtbWFzdGVyIC11IGt1c2VyIC1jIC9vcHQvY29udGFpbmVycyAjdGhlIHJlc3QgcGFyYW1ldGVycyB3aWxsIGJlIHVzaW5nIGRlZmF1bHQgdmFsdWVzXG4iCiAgIGV4aXQgMQp9CgoKZ2V0X3BhcmFtcygpCnsKICAgbG9jYWwgT1BUSU5ECiAgIHdoaWxlIGdldG9wdHMgIm06dTpsOnM6azpjOm46bzpoIiBQQVJBTQogICBkbwogICAgICBjYXNlICIkUEFSQU0iIGluCiAgICAgIG0pIAogICAgICAgICAgI21vZGUKICAgICAgICAgIE1PREU9JHtPUFRBUkd9CiAgICAgICAgICA7OwogICAgICB1KQogICAgICAgICAgI0t1YmUgdXNlcgogICAgICAgICAgS1VCRV9VU0VSPSR7T1BUQVJHfQogICAgICAgICAgVEhFVVNFUj0kS1VCRV9VU0VSCiAgICAgICAgICA7OwogICAgICBsKQogICAgICAgICAgI2xvY2FsIHN0b3JhZ2UKICAgICAgICAgIExPQ0FMX1NUT1JBR0U9JHtPUFRBUkd9CiAgICAgICAgICBMT0NBTFNUT1JBR0U9JExPQ0FMX1NUT1JBR0UKICAgICAgICAgIDs7CiAgICAgIHMpCiAgICAgICAgICAjc3RvcmFnZSBjbGFzcwogICAgICAgICAgU1RPUkFHRV9DTEFTUz0ke09QVEFSR30KICAgICAgICAgIDs7CgogICAgICBrKQogICAgICAgICAgI2t1YmVsZXQgc3RvcmFnZQogICAgICAgICAgS1VCRV9TVE9SQUdFPSR7T1BUQVJHfQogICAgICAgICAgS1VCRVNUT1JBR0U9JEtVQkVfU1RPUkFHRQogICAgICAgICAgOzsKICAgICAgYykKICAgICAgICAgICNjb250YWluZXJzIHN0b3JhZ2UKICAgICAgICAgIENPTlRBSU5FUl9TVE9SQUdFPSR7T1BUQVJHfQogICAgICAgICAgQ09OVEFJTkVSU1RPUkFHRT0kQ09OVEFJTkVSX1NUT1JBR0UKICAgICAgICAgIDs7CiAgICAgIG4pCgkgICNuZXR3b3JrIG9yY2hlc3RyYXRpb24KCSAgQ05JUEFSQU09JHtPUFRBUkd9CgkgIDs7CiAgICAgIGgpCiAgICAgICAgICAjZGlzcGxheSB0aGlzIHVzYWdlCiAgICAgICAgICB1c2FnZV9rOHMKICAgICAgICAgIDs7CiAgICAgID8pCiAgICAgICAgICBlY2hvIC1lICJcbkVycm9yOiAgVW5rbm93biBwYXJhbWV0ZXIocykuLi5cbiIKICAgICAgICAgIHVzYWdlX2s4cwogICAgICBlc2FjCiAgICBkb25lCgogICAgc2hpZnQgJCgoT1BUSU5ELTEpKQoKICAgIGNhc2UgIiRDTklQQVJBTSIgaW4KICAgICdmJykKICAgICAgICBDTklQTFVHSU49IiRGTEFOTkVMIgogICAgICAgIE5FVFBMVUdJTj0iRmxhbm5lbCIKCTs7CiAgICAnYycpCglDTklQTFVHSU49IiRDQUxJQ08iCiAgICAgICAgTkVUUExVR0lOPSJDYWxpY28iCglleHBvcnQgS1VCRVBBUkFNSU5JVD0iJEtVQkVQQVJBTUlOSVQgLS1zZXJ2aWNlLWNpZHI9MTAuMjQ1LjAuMC8xNiIKICAgICAgICA7OwogICAgJ2NpJykKCUNOSVBMVUdJTj0iJENJTElVTSIKICAgICAgICBORVRQTFVHSU49IkNpbGl1bSIKICAgICAgICA7OwogICAgJ3cnKQoJQ05JUExVR0lOPSJXRUFWRU5FVCIKICAgICAgICBbWyAhIC1kIC91c3IvbG9jYWwvYmluIF1dICYmIG1rZGlyIC1wIC91c3IvbG9jYWwvYmluIAogICAgICAgIFtbICEgLWYgL3Vzci9sb2NhbC9iaW4vd2VhdmUgXV0gJiYgIGN1cmwgLUwgZ2l0LmlvL3dlYXZlIC1vIC91c3IvbG9jYWwvYmluL3dlYXZlICYmIGNobW9kIHVnbytyeCAvdXNyL2xvY2FsL2Jpbi93ZWF2ZQogICAgICAgIE5FVFBMVUdJTj0iV2VhdmUiCgkgZXhwb3J0IEtVQkVQQVJBTUlOSVQ9IiIKICAgICAgICA7OwogICAgKikKCUNOSVBMVUdJTj0iJENBTElDTyIKICAgICAgICBORVRQTFVHSU49IkNhbGljbyIKCWV4cG9ydCBLVUJFUEFSQU1JTklUPSIkS1VCRVBBUkFNSU5JVCAtLXNlcnZpY2UtY2lkcj0xMC4yNDUuMC4wLzE2IgogICAgZXNhYwoKfQoKY2hlY2tfbW91bnRwb2ludCgpCnsKbG9jYWwgU1RPUkFHRT0iJDEiCiAgICAgICAgW1sgIiRTVE9SQUdFIiA9ICIiIF1dICYmIHJldHVybiAwCglpZiBbICEgLWQgJFNUT1JBR0UgXQogICAgICAgIHRoZW4KICAgICAgICAgICAgU1RPUkFHRVBBUkVOVD0kKGRpcm5hbWUgJFNUT1JBR0UpCiAgICAgICAgICAgIGVjaG8gIlRoZSBtb3VudHBvaW50ICRTVE9SQUdFIGlzIG5vdCBhdmFpbGFibGUsIGhvd2V2ZXIgdGhlIHBhcmVudCBkaXJlY3RvcnkgaXMgbW91bnRlZCB1bmRlciAkU1RPUkFHRVBBUkVOVCIKICAgICAgICAgICAgU1RPUkFHRVBBUkVOVD0kKGRmICRTVE9SQUdFUEFSRU5UIHwgYXdrICd7cHJpbnQgJE5GfScgfCB0YWlsIC0xKQogICAgICAgICAgICBpZiBbICIkU1RPUkFHRVBBUkVOVCIgPSAiLyIgXQogICAgICAgICAgICB0aGVuCiAgICAgICAgICAgICAgIGVjaG8gLWUgIlxuVGhlIG1vdW50ICRTVE9SQUdFIHdpbGwgYmUgY3JlYXRlZCB1bmRlciByb290ICcvJyBmaWxlc3lzdGVtLCBwbGVhc2UgbW91bnQgaXQgb24gYSBkaWZmZXJlbnQgZmlsZXN5c3RlbVxuIiAmJiBleGl0IDEKICAgICAgICAgICAgZWxzZQoJICAgICAgIERGU0laRT1gZGYgLW0gJFNUT1JBR0VQQVJFTlQgfCBhd2sgJ3twcmludCAkNH0nIHwgdGFpbCAtMWAKICAgICAgICAgICAgICAgQ1VSUlNJWkU9MAogICAgICAgICAgICAgICBNT1VOVFBPSU5UPWBkZiAkU1RPUkFHRVBBUkVOVCB8IGF3ayAne3ByaW50ICRORn0nIHwgdGFpbCAtMWAKICAgICAgICAgICAgZmkKICAgICAgICBlbHNlCiAgICAgICAgICAgIGlmIFsgIiQoZGYgJFNUT1JBR0UgfCBhd2sgJ3twcmludCAkTkZ9JykiID0gIi8iIF0KICAgICAgICAgICAgdGhlbgogICAgICAgICAgICAgICBlY2hvIC1lICJcblRoZSBtb3VudCAkU1RPUkFHRSB3aWxsIGJlIGNyZWF0ZWQgdW5kZXIgcm9vdCAnLycgZmlsZXN5c3RlbSwgcGxlYXNlIG1vdW50IGl0IG9uIGEgZGlmZmVyZW50IGZpbGVzeXN0ZW1cbiIgJiYgZXhpdCAxCiAgICAgICAgICAgIGVsc2UKCSAgICAgICBDVVJSU0laRT1gZHUgLXNtICRTVE9SQUdFIHwgYXdrICd7cHJpbnQgJDF9J2AKCSAgICAgICBbWyAkQ1VSUlNJWkUgLWd0IDAgXV0gJiYgQ1VSUlNJWkU9JCgoQ1VSUlNJWkUvMTAyNCkpCgkgICAgICAgREZTSVpFPWBkZiAtbSAkU1RPUkFHRSB8IGF3ayAne3ByaW50ICQ0fScgfCB0YWlsIC0xYAogICAgICAgICAgICAgICBNT1VOVFBPSU5UPWBkZiAkU1RPUkFHRSB8IGF3ayAne3ByaW50ICRORn0nIHwgdGFpbCAtMWAKICAgICAgICAgICAgZmkKICAgICAgICBmaQp9CgpjaGVja19kaXNrc3BhY2UoKQp7CiAgIGlmIFsgIiRNT0RFIiAhPSAiIiAtYSAiJE1PREUiICE9ICJzaW5nbGUiIF0KICAgdGhlbgogICAgICBlY2hvICJDaGVja2luZyBMb2NhbCBzdG9yYWdlIgogICAgICBjaGVja19tb3VudHBvaW50ICIkTE9DQUxTVE9SQUdFIgogICAgICBMQ1VSUlNJWkU9JENVUlJTSVpFCiAgICAgIExGUkVFU0laRT0kKChERlNJWkUvMTAyNCkpCiAgICAgIExNT1VOVFBPSU5UPSRNT1VOVFBPSU5UCgogICBmaQp9CgpyZW1vdmVfb2ZmZW5kaW5nX2tleSgpCnsKc2V0IC14CiAgIGxvY2FsIElQQUREUj0iJDEiCiAgIE9GRkVORElOR0xJTkU9JChzc2gtY29weS1pZCAkSVBBRERSIDI+JjEgfCBncmVwICJFUlJPUjogT2ZmZW5kaW5nIEVDRFNBIGtleSBpbiIpCiAgIGlmIFsgIiRPRkZFTkRJTkdMSU5FIiAhPSAiIiBdCiAgIHRoZW4KICAgICAgVEhFTElORT0kKGVjaG8gJE9GRkVORElOR0xJTkUgfCBhd2sgJ3twcmludCAkTkZ9JyB8IHRyIC1kICdccicpCiAgICAgIE9MSU5FPSQoZWNobyAkVEhFTElORSB8IGN1dCAtZjEgLWQ6KQogICAgICBPTElORU5PPSQoZWNobyAkVEhFTElORSB8IGN1dCAtZjIgLWQ6KQogICAgICBpZiBbICRPTElORU5PIC1ndCAwIF0KICAgICAgdGhlbgogICAgICAgICBzZWQgLWkgIiR7T0xJTkVOT31kIiAkT0xJTkUKICAgICAgZmkKICAgZmkKc2V0ICt4Cn0gCiAgICAgIAoKY29weV9wdWJsaWNfa2V5KCkKewogICBsb2NhbCBJUEFERFI9IiQxIgogICBlY2hvICJUcnlpbmcgdG8gY29weSBwdWJsaWMga2V5IGZyb20gLnNzaCBkaXJlY3RvcnkuLi4iCiAgIGVjaG8gIlRyeWluZyB0byBjcmVhdGUgdHJ1c3RlZCBjb25uZWN0aW9uIGZyb20gdGhpcyBob3N0ICQoaG9zdG5hbWUgLWYpIHRvICRJUEFERFIiCiAgIGlmIFsgLWYgfi8uc3NoL2lkX3JzYS5wdWIgXQogICB0aGVuCiAgICAgIHNzaC1jb3B5LWlkICRJUEFERFIKICAgICAgd2hpbGUgWyAkPyAtbmUgMCBdCiAgICAgIGRvCiAgICAgICAgIHJlbW92ZV9vZmZlbmRpbmdfa2V5ICIkSVBBRERSIiAgICAgICAgIAogICAgICAgICBlY2hvICJcbklmIHlvdSBkb250IGtub3cgdGhlIHJvb3QgcGFzc3dvcmQgcHJlc3MgQ3RybCtjIHRoZW4gcGxlYXNlIGFzayBzb21lb25lIHdobyBrbm93cyAhIS4uLlxuIgogICAgICAgICBzc2gtY29weS1pZCAkSVBBRERSCiAgICAgICAgIHNsZWVwIDIKICAgICAgZG9uZQogICBlbHNlCiAgICAgIHllcyAneScgfCBzc2gta2V5Z2VuIC10IHJzYSAtTiAnJyAtZiB+Ly5zc2gvaWRfcnNhCiAgICAgIHNzaC1jb3B5LWlkICRJUEFERFIKICAgICAgd2hpbGUgWyAkPyAtbmUgMCBdCiAgICAgIGRvCiAgICAgICAgIHJlbW92ZV9vZmZlbmRpbmdfa2V5ICIkSVBBRERSIgogICAgICAgICBlY2hvIC1lICJcbklmIHlvdSBkb250IGtub3cgdGhlIHJvb3QgcGFzc3dvcmQgcHJlc3MgQ3RybCtjIHRoZW4gcGxlYXNlIGFzayBzb21lb25lIHdobyBrbm93cyAhIS4uLlxuIgogICAgICAgICBzc2gtY29weS1pZCAkSVBBRERSCiAgICAgICAgIHNsZWVwIDIKICAgICAgZG9uZQogICBmaQp9CgpnZXRfa3ViZWFkbV9qb2luX2NtZCgpCnsKICAgICAgaWYgWyAiJEtVQkVBRE1fSk9JTl9DTUQiID0gIiIgXQogICAgICB0aGVuCgkgaWYgWyAiJE1BU1RFUklQIiAhPSAiIiBdCgkgdGhlbgogICAgICAgICAgICBUSEVDT01NQU5EPWBzc2ggLW8gIlN0cmljdEhvc3RLZXlDaGVja2luZyBubyIgcm9vdEAke01BU1RFUklQfSAiW1sgLWYgfi8ua3ViZS9jb25maWcgXV0gJiYgbXYgfi8ua3ViZS9jb25maWcgfi8ua3ViZS9jb25maWcuYmFrOyBrdWJlYWRtIHRva2VuIGNyZWF0ZSAtLXByaW50LWpvaW4tY29tbWFuZCIgfCBncmVwICJea3ViZWFkbSIgMj4vZGV2L251bGxgCgkgICAgaWYgWyAiJFRIRUNPTU1BTkQiICE9ICIiIF0KICAgICAgICAgICAgICAgdGhlbgogICAgICAgICAgICAgICBleHBvcnQgS1VCRUFETV9KT0lOX0NNRD0iJFRIRUNPTU1BTkQiCgkgICAgZWxzZQoJICAgICAgIGVjaG8gIlVuYWJsZSB0byByZXRyaWV2ZSBqb2luIGNvbW1hbmQsIHBsZWFzZSBkbyBpdCBtYW51YWxseSEhIgoJICAgICAgIGVjaG8gInJ1biB0aGUgZm9sbG93aW5nIGNvbW1hbmQgb24gbWFzdGVyIG5vZGU6ICIKCSAgICAgICBlY2hvICIgIGt1YmVhZG0gdG9rZW4gY3JlYXRlIC0tcHJpbnQtam9pbi1jb21tYW5kIgoJICAgICAgIGV4aXQgMQoJICAgIGZpCgogICAgICAgICBlbHNlICAgCiAgICAgICAgICAgIGVjaG8gIk5lZWQgYm9vdHN0cmFwIGtleSBmcm9tIG1hc3RlciEhIgogICAgICAgICAgICBlY2hvIC1uICJEbyB5b3Ugd2FudCB0byB0cnkgdG8gcmV0cmlldmUgaXQgZnJvbSBtYXN0ZXIgbm9kZSA/PyAoWS9uKSAiOyByZWFkIGFucwogICAgICAgICAgICBlY2hvICIgIgogICAgICAgICAgICBpZiBbICIkYW5zIiA9ICJZIiBdCiAgICAgICAgICAgIHRoZW4KICAgICAgICAgICAgICAgZWNobyAtbiAiV2hhdCBpcyB0aGUgaXAgYWRkcmVzcyBvZiBtYXN0ZXIgc2VydmVyIDogIjsgcmVhZCBtYXN0ZXJpcAogICAgICAgICAgICAgICBlY2hvIC1lICJcblRyeWluZyB0byBjb25uZWN0IHRvIHJvb3RAJG1hc3RlcmlwLCB5b3UgYWxzbyBuZWVkIHRvIHN1cHBseSByb290IHBhc3N3b3JkLi4uXG4iCiAgICAgICAgICAgICAgIGNvcHlfcHVibGljX2tleSAkbWFzdGVyaXAgCiAgICAgICAgICAgICAgIFRIRUNPTU1BTkQ9YHNzaCAtbyAiU3RyaWN0SG9zdEtleUNoZWNraW5nIG5vIiByb290QCRtYXN0ZXJpcCAiW1sgLWYgfi8ua3ViZS9jb25maWcgXV0gJiYgbXYgfi8ua3ViZS9jb25maWcgfi8ua3ViZS9jb25maWcuYmFrOyBrdWJlYWRtIHRva2VuIGNyZWF0ZSAtLXByaW50LWpvaW4tY29tbWFuZCIgfCBncmVwICJea3ViZWFkbSIgMj4vZGV2L251bGxgCgogICAgICAgICAgICAgICBpZiBbICIkVEhFQ09NTUFORCIgIT0gIiIgXQogICAgICAgICAgICAgICB0aGVuCiAgICAgICAgICAgICAgICAgIGVjaG8gIkpvaW4gY29tbWFuZCBpcyA6ICRUSEVDT01NQU5EIgogICAgICAgICAgICAgICAgICBleHBvcnQgS1VCRUFETV9KT0lOX0NNRD0iJFRIRUNPTU1BTkQiCiAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgZWNobyAiU29tZXRoaW5nIHdlbnQgd3JvbmcuLiB5b3UgbXVzdCBkbyBpdCBtYW51YWxseSwgZ290byB0aGUgbWFzdGVyIHNlcnZlciB0aGVuIgogICAgICAgICAgICAgICAgICBlY2hvICJXb3JrZXIgbm9kZSByZXF1aXJlcyBmdWxsIGt1YmVhZG0gam9pbiBjb21tYW5kIGZyb20ga3ViZXJuZXRlcyBtYXN0ZXIgbm9kZSB3aGljaCBtdXN0IGJlIHNldCB0byBlbnYgdmFyaWFibGUgS1VCRUFETV9KT0lOX0NNRCIKICAgICAgICAgICAgICAgICAgZWNobyAiUnVuIHRoZSBmb2xsb3dpbmcgY29tbWFuZCBvbiBhIGt1YmVybmV0ZXMgbWFzdGVyIG5vZGU6IgogICAgICAgICAgICAgICAgICBlY2hvICJrdWJlYWRtIHRva2VuIGNyZWF0ZSAtLXByaW50LWpvaW4tY29tbWFuZCIKICAgICAgICAgICAgICAgICAgZWNobyAiYWZ0ZXIgdGhhdCBsb2cgYmFjayBpbiB0byB0aGkgc25vZGUgdGhlbiBydW4gdGhlIGZvbGxvd2luZyBjb21tYW5kIGJlZm9yZSB5b3UgcnVuIHNldHVwLWs4cy5zaCIKICAgICAgICAgICAgICAgICAgZWNobyAiZXhwb3J0IEtVQkVBRE1fSk9JTl9DTUQ9XCJ0aGUtcmVzdWx0LXlvdS1nZXQtZnJvbS10aGUtYWJvdmUtY29tbWFuZFwiIgogICAgICAgICAgICAgICAgICBlY2hvICJFLmc6IgogICAgICAgICAgICAgICAgICBlY2hvICJleHBvcnQgS1VCRUFETV9KT0lOX0NNRD1rdWJlYWRtIGpvaW4gMTcyLjE3LjcuNDo2NDQzIC0tdG9rZW4gbDhzdGQxLjJzdWhqbGdnbWR6YmppbHkgXCAiCiAgICAgICAgICAgICAgICAgIGVjaG8gIi0tZGlzY292ZXJ5LXRva2VuLWNhLWNlcnQtaGFzaCBzaGEyNTY6NmM4M2ExMGE0M2RkODIzNmMyZWQ5MTcxYzViMjQ5NGU5Zjk5NjVmY2EyNjRmMDI4MDEyYTdjNmYwZmVmMzBmMyIKICAgICAgICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgICAgZmkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICBlY2hvICJZb3UgYXJlIGNob29zaW5nIHRvIGRvIGl0IG1hbnVhbGx5Li4uISEiCiAgICAgICAgICAgICAgIGVjaG8gIldvcmtlciBub2RlIHJlcXVpcmVzIGZ1bGwga3ViZWFkbSBqb2luIGNvbW1hbmQgZnJvbSBrdWJlcm5ldGVzIG1hc3RlciBub2RlIHdoaWNoIG11c3QgYmUgc2V0IHRvIGVudiB2YXJpYWJsZSBLVUJFQURNX0pPSU5fQ01EIgogICAgICAgICAgICAgICBlY2hvICJFLmc6IgogICAgICAgICAgICAgICBlY2hvICJleHBvcnQgS1VCRUFETV9KT0lOX0NNRD1rdWJlYWRtIGpvaW4gMTcyLjE3LjcuNDo2NDQzIC0tdG9rZW4gbDhzdGQxLjJzdWhqbGdnbWR6YmppbHkgXCAiCiAgICAgICAgICAgICAgIGVjaG8gIi0tZGlzY292ZXJ5LXRva2VuLWNhLWNlcnQtaGFzaCBzaGEyNTY6NmM4M2ExMGE0M2RkODIzNmMyZWQ5MTcxYzViMjQ5NGU5Zjk5NjVmY2EyNjRmMDI4MDEyYTdjNmYwZmVmMzBmMyIKICAgICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgICAgZmkKCSBmaQogICAgICBlbHNlCiAgICAgICAgIGVjaG8gIkNvcHlpbmcgcHVibGljIGtleSB0byBtYXN0ZXIgbm9kZSAkTUFTVEVSTk9ERS4uLi4uIgogICAgICAgICBNQVNURVJOT0RFPWBlY2hvICRLVUJFQURNX0pPSU5fQ01EIHwgYXdrICd7cHJpbnQgJDN9JyB8IGN1dCAtZjEgLWQnOidgCiAgICAgICAgIGNvcHlfcHVibGljX2tleSAkTUFTVEVSTk9ERSAKICAgICAgZmkKfQoKcmVzZXRfb25seSgpCnsKICAgc3UgLSAkVEhFVVNFUiAtYyAia3ViZWN0bCBnZXQgbm9kZXMgMj4vZGV2L251bGwgMT4vZGV2L251bGwiCiAgIGlmIFsgJD8gLWVxIDAgXQogICB0aGVuCiAgICAgIEhPU1ROQU1FPWBob3N0bmFtZWAKICAgICAgSE9TVDJERUxFVEU9YHN1IC0gJFRIRVVTRVIgLWMgImt1YmVjdGwgZ2V0IG5vZGVzIC0tbm8taGVhZGVycz10cnVlIHwgZ3JlcCAtdiBtYXN0ZXIgfCBncmVwICRIT1NUTkFNRSB8YXdrICd7cHJpbnQgXCQxfSciYAogICAgICBpZiBbICIkSE9TVDJERUxFVEUiICE9ICIiIF0KICAgICAgdGhlbgogICAgICAgICAgc3UgLSAkVEhFVVNFUiAtYyAia3ViZWN0bCBkcmFpbiAkSE9TVE5BTUUgLS1kZWxldGUtZW1wdHlkaXItZGF0YSAtLWZvcmNlIC0taWdub3JlLWRhZW1vbnNldHMiCiAgICAgICAgICBzdSAtICRUSEVVU0VSIC1jICJrdWJlY3RsIGRlbGV0ZSBub2RlICRIT1NUTkFNRSIKICAgICAgZWxzZQogICAgICAgICAgZm9yIGhvc3QyZGVsIGluIGBzdSAtICRUSEVVU0VSIC1jICJrdWJlY3RsIGdldCBub2RlcyAtLW5vLWhlYWRlcnM9dHJ1ZSB8IGdyZXAgLXYgJEhPU1ROQU1FIHwgYXdrICd7cHJpbnQgXCQxfSciYAogICAgICAgICAgZG8KICAgICAgICAgICAgICBzdSAtICRUSEVVU0VSIC1jICJrdWJlY3RsIGRyYWluICRIT1NUTkFNRSAtLWRlbGV0ZS1lbXB0eWRpci1kYXRhIC0tZm9yY2UgLS1pZ25vcmUtZGFlbW9uc2V0cyIKICAgICAgICAgICAgICBzdSAtICRUSEVVU0VSIC1jICJrdWJlY3RsIGRlbGV0ZSBub2RlICRIT1NUTkFNRSIKICAgICAgICAgIGRvbmUKICAgICAgZmkKICAgZmkKICAgaWYgWyBgcHMgLWVmIHwgZ3JlcCAiYmluL2t1YmVsZXQiIHwgZ3JlcCAtdiBncmVwIHwgd2MgLWxgIC1ndCAwIF0KICAgdGhlbgogICAgICAgS1VCRVBJRD1gcHMgLWVvIHBpZCxjbWQgfCBncmVwICJiaW4va3ViZWxldCIgfCBncmVwIC12IGdyZXAgfCBhd2sgJ3twcmludCAkMX0nYAogICAgICAgW1sgIiRLVUJFUElEIiAhPSAiIiBdXSAmJiBlY2hvICJLaWxsaW5nIGt1YmVsZXQuLi4iICYmIHN5c3RlbWN0bCBzdG9wIGt1YmVsZXQgJiYga2lsbCAtOSAkS1VCRVBJRCAyPi9kZXYvbnVsbCAxPi9kZXYvbnVsbAogICBmaQogICByZXNldF9rdWJlYWRtCiAgIGRlbGV0ZV9lcGhlbWVyYWxfZGlza3MKCn0KCiAgIApkZWxldGVfZXBoZW1lcmFsX2Rpc2tzKCkKewogICBpZiBbIC1kIC92YXIvbGliL2t1YmVsZXQgXQogICB0aGVuCiAgICAgICAgZm9yIE1UUE9JTlQgaW4gYG1vdW50ICB8IGdyZXAgIlxcL3ZhclxcL2xpYlxcL2t1YmVsZXQiIHwgYXdrICd7cHJpbnQgJDN9J2AKICAgICAgICBkbwogICAgICAgICAgICBlY2hvICJVbm1vdW50aW5nIGt1YmVsZXQgYmluZCB2b2x1bWUgJE1UUE9JTlQiCiAgICAgICAgICAgIHVtb3VudCAkTVRQT0lOVCAyPi9kZXYvbnVsbCAxPi9kZXYvbnVsbAogICAgICAgIGRvbmUKICAgICAgICBybSAtcmYgL3Zhci9saWIva3ViZWxldC8qCiAgIGVsaWYgWyAiJChyZWFkbGluayAvdmFyL2xpYi9rdWJlbGV0KSIgIT0gIi92YXIvbGliL2t1YmVsZXQiIC1hICIkKHJlYWRsaW5rIC92YXIvbGliL2t1YmVsZXQpIiAhPSAiIiBdCiAgIHRoZW4KICAgICAgICBLVUJFTEVURElSUEFUVEVSTj0iJChyZWFkbGluayAvdmFyL2xpYi9rdWJlbGV0IHwgc2VkICdzfC98XFxcL3xnJykiCiAgICAgICAgZm9yIE1UUE9JTlQgaW4gYG1vdW50ICB8IGdyZXAgIiRLVUJFTEVURElSUEFUVEVSTiIgfCBhd2sgJ3twcmludCAkM30nYAogICAgICAgIGRvCiAgICAgICAgICAgIGVjaG8gIlVubW91bnRpbmcga3ViZWxldCBiaW5kIHZvbHVtZSAkTVRQT0lOVCIKICAgICAgICAgICAgdW1vdW50ICRNVFBPSU5UIDI+L2Rldi9udWxsIDE+L2Rldi9udWxsCiAgICAgICAgZG9uZQogICAgICAgIHJtIC1yZiAvdmFyL2xpYi9rdWJlbGV0LyoKICAgZmkKCiAgIGlmIFsgLWQgL3Zhci9saWIvY29udGFpbmVycyBdCiAgIHRoZW4KICAgICAgICBmb3IgTVRQT0lOVCBpbiBgbW91bnQgIHwgZ3JlcCAiXFwvdmFyXFwvbGliXFwvY29udGFpbmVycyIgfCBhd2sgJ3twcmludCAkM30nYAogICAgICAgIGRvCiAgICAgICAgICAgIGVjaG8gIlVubW91bnRpbmcgY29udGFpbmVycyBiaW5kIHZvbHVtZSAkTVRQT0lOVCIKICAgICAgICAgICAgdW1vdW50ICRNVFBPSU5UIDI+L2Rldi9udWxsIDE+L2Rldi9udWxsCiAgICAgICAgZG9uZQogICAgICAgIHJtIC1yZiAvdmFyL2xpYi9jb250YWluZXJzLyoKICAgZWxpZiBbICIkKHJlYWRsaW5rIC92YXIvbGliL2NvbnRhaW5lcnMpIiAhPSAiL3Zhci9saWIvY29udGFpbmVycyIgLWEgIiQocmVhZGxpbmsgL3Zhci9saWIvY29udGFpbmVycykiICE9ICIiIF0KICAgdGhlbgogICAgICAgIENPTlRBSU5FUlNQQVRURVJOPSIkKHJlYWRsaW5rIC92YXIvbGliL2NvbnRhaW5lcnMgfCBzZWQgJ3N8L3xcXFwvfGcnKSIKICAgICAgICBmb3IgTVRQT0lOVCBpbiBgbW91bnQgIHwgZ3JlcCAiJENPTlRBSU5FUlNQQVRURVJOIiB8IGF3ayAne3ByaW50ICQzfSdgCiAgICAgICAgZG8KICAgICAgICAgICAgZWNobyAiVW5tb3VudGluZyBjb250YWluZXJzIGJpbmQgdm9sdW1lICRNVFBPSU5UIgogICAgICAgICAgICB1bW91bnQgJE1UUE9JTlQgMj4vZGV2L251bGwgMT4vZGV2L251bGwKICAgICAgICBkb25lCiAgICAgICAgcm0gLXJmIC92YXIvbGliL2NvbnRhaW5lcnMvKgogICBmaQoKCiAgIGZvciBNVFBPSU5UIGluIGBtb3VudCAgfCBncmVwICJsb2NhbC1zdG9yYWdlIiB8IGF3ayAne3ByaW50ICQzfSdgCiAgIGRvCiAgICAgICBlY2hvICJVbm1vdW50aW5nIGxvY2FsLXN0b3JhZ2UgYmluZCB2b2x1bWUgJE1UUE9JTlQiCiAgICAgICB1bW91bnQgJE1UUE9JTlQgMj4vZGV2L251bGwgMT4vZGV2L251bGwKICAgICAgIFtbICQ/IC1lcSAwIF1dICYmIHJtIC1yZiAkTVRQT0lOVAogICBkb25lCgp9CgoKewogICBnZXRfcGFyYW1zICIkQCIKCiAgIGlmIFsgIiRNT0RFIiA9ICJyZXNldC1hbGwiIF0KICAgdGhlbgogICAgICBlY2hvICJSZXNldHRpbmcgYW55dGhpbmcgcmVsYXRlZCB0byBrdWJlcm5ldGVzLi4uLi4uLi4uLi4iCiAgICAgIHJlc2V0X29ubHkKICAgICAgZXhpdCAwCiAgIGVsaWYgWyAiJE1PREUiID0gImRlc3Ryb3ktYWxsIiBdCiAgIHRoZW4KICAgICAgZWNobyAiRGVzdHJveWluZyBhbmQgUmVtb3ZpbmcgYW55dGhpbmcgcmVsYXRlZCB0byBrdWJlcm5ldGVzLi4uLi4uLi4uLi4iCiAgICAgIGRlc3Ryb3lfZXZlcnl0aGluZwogICAgICBleGl0IDAKICAgZmkKICAgCiAgIFtbICIkKGVjaG8gJE1PREUgfCBncmVwIHJlc2V0IHwgY3V0IC1mMSAtZCctJykiID0gInJlc2V0IiBdXSAmJiBSRVNFVD0xCgogICBpZiBbICIkKGVjaG8gJE1PREUgfCBncmVwIHdvcmtlciB8IGN1dCAtZjIgLWQnLScpIiA9ICJ3b3JrZXIiIF0KICAgdGhlbgogICAgICBUSEVOT0RFPSJXT1JLRVIiCiAgICAgIGdldF9rdWJlYWRtX2pvaW5fY21kCiAgICAgIFtbICQ/IC1uZSAwIF1dICYmIGV4aXQgMQoJICAgIAogICBlbGlmIFsgIiQoZWNobyAkTU9ERSB8IGdyZXAgbWFzdGVyIHwgY3V0IC1mMiAtZCctJykiID0gIm1hc3RlciIgXQogICB0aGVuCiAgICAgIFRIRU5PREU9Ik1BU1RFUiIKICAgICAgVEhFTUVTU0FHRT0iXG5Cb290c3RyYXBpbmcgYSBLdWJlcm5ldGVzIGNsdXN0ZXIuLi4uLi4uLi4uLi4uLiIKICAgZWxpZiBbICIkTU9ERSIgPSAic2luZ2xlIiBdCiAgIHRoZW4KICAgICAgVEhFTk9ERT0iU0lOR0xFIgogICAgICBUSEVNRVNTQUdFPSJcblJlc3VtaW5nIEt1YmVybmV0ZXMgc2luZ2xlIGNsdXN0ZXIgaW5zdGFsbGF0aW9uLi4iCiAgICAgIExPQ0FMU1RPUkFHRT1gZGlybmFtZSAkKG1vdW50ICB8IGdyZXAgImxvY2FsLXN0b3JhZ2VcL3ZvbCIgfCBhd2sgJ3twcmludCAkM30nIHwgaGVhZCAtMSkgMj4vZGV2L251bGxgCiAgICAgIGlmIFsgIiRMT0NBTFNUT1JBR0UiICE9ICIiIF0KICAgICAgdGhlbgogICAgICAgICAgU1RPUkFHRV9DTEFTUz0ibG9jYWwtc3RvcmFnZSIKICAgICAgZWxzZQogICAgICAgICAgU1RPUkFHRV9DTEFTUz1gc3UgLSAkVEhFVVNFUiAtYyAia3ViZWN0bCBnZXQgc2MgLUEgLW89anNvbnBhdGg9J3suaXRlbXNbMF0ubWV0YWRhdGEubmFtZX0nIDI+L2Rldi9udWxsIiAyPi9kZXYvbnVsbGAKICAgICAgZmkKICAgZWxpZiBbICIkTU9ERSIgPSAicmVzZXQtc2luZ2xlIiBdCiAgIHRoZW4KICAgICAgVEhFTk9ERT0iU0lOR0xFIgogICAgICBUSEVNRVNTQUdFPSJcbkluc3RhbGxpbmcgS3ViZXJuZXRlcyBvbiBhIHNpbmdsZSBjbHVzdGVyLi4iCiAgIGVsc2UKICAgICAgaWYgWyAtZCAuLi8kSzhTREVQTE9ZX0RJUiBdCiAgICAgIHRoZW4KCSBpZiBbICQoY2F0ICRQUk9HUkVTU19GSUxFIHwgd2MgLWwpIC1lcSAwIF0KICAgICAgICAgdGhlbgoJICAgICBlY2hvIC1lICJcblxuaXQgc2VlbXMgcHJvZ3Jlc3MgZmlsZSBoYXMgbm8gZW50cnkuLiBwbGVhc2UgcnVuIHNldHVwLWs4cy5zaCB3aXRoIHRoZSBmb2xsb3dpbmcgcGFyYW1ldGVycy4uLi4iCgkgICAgIHVzYWdlX2s4cwoJICAgICBleGl0IDAKCSBmaQogICAgICBlbHNlCgkgZWNobyAtZSAiXG5cbml0IHNlZW1zIHlvdSBoYXZlIG5ldmVyIGluc3RhbGxlZCBLdWJlcm5ldGVzIHVzaW5nIHRoaXMgc2NyaXB0IGJlZm9yZS4uIHBsZWFzZSBydW4gc2V0dXAtazhzLnNoIHdpdGggdGhlIHRoZSBmb2xsaW5nIHBhcmFtZXRlcnMgOiIKCSB1c2FnZV9rOHMKCSBleGl0IDAKICAgICAgZmkKICAgICAgVEhFTk9ERT0iTUFTVEVSL1dPUktFUiIKICAgZmkKCgogICBpZiBbICIkUkVTRVQiID0gIjEiIF0KICAgdGhlbgogICAgICBpZiBbICIkTE9DQUxfU1RPUkFHRSIgIT0gIiIgXQogICAgICB0aGVuIAogICAgICAgICAgaWYgWyAiJFNUT1JBR0VfQ0xBU1MiICE9ICIiIF0KICAgICAgICAgIHRoZW4KICAgICAgICAgICAgIGVjaG8gIlBhcmFtZXRlciAtbCAobG9jYWwgc3RvcmFnZSBsb2NhdGlvbikgaXMgbW9yZSBwcmVjZWRlbmNlIHRoYW4gcGFyYW1ldGVyIC1zIChzdG9yYWdlIGNsYXNzKSIKICAgICAgICAgICAgIGVjaG8gIlNldHRpbmcgc3RvcmFnZSBjbGFzcyB0byBsb2NhbC1zdG9yYWdlIgogICAgICAgICAgZmkKICAgICAgICAgIFNUT1JBR0VfQ0xBU1M9ImxvY2FsLXN0b3JhZ2UiCiAgICAgIGVsc2UKCSAgaWYgWyAiJFNUT1JBR0VfQ0xBU1MiICE9ICIiIF0KICAgICAgICAgIHRoZW4KICAgICAgICAgICAgIGVjaG8gLWUgIlxuU2V0dGluZyBzdG9yYWdlIGNsYXNzIHRvICRTVE9SQUdFX0NMQVNTICIKICAgICAgICAgICAgIGVjaG8gLWUgIlBsZWFzZSBOT1RFLCBpZiBpdCBpcyBvbiBhIHNpbmdsZSBjbHVzdGVyIHRoZW4geW91IGhhdmUgdG8gbWFrZSBzdXJlIHRoaXMgc3RvcmFnZSBjbGFzcyBcIiRTVE9SQUdFX0NMQVNTXCIgaXMgYXZhaWxhYmxlLCBvdGhlcndpc2UgdGhlIEt1YmVybmV0ZXMgd2lsbCBmYWlsISEiCiAgICAgICAgICAgICBlY2hvIC1lICIgICAgICAgICAgICAgaWYgaXQgaXMgb24gYSBtYXN0ZXIsIHlvdSBtdXN0IGVuc3VyZSB0aGlzIHN0b3JhZ2UgY2xhc3MgXCIkU1RPUkFHRV9DTEFTU1wiIGlzIGF2YWlsYWJsZSBiZWZvcmUgd29ya2VyIG5vZGUgaXMgam9pbmVkIHRvIHRoaXMgY2x1c3RlciEhXG5cbiIKCSAgZmkKICAgICAgZmkgCiAgIGVsc2UKICAgICAgaWYgWyAiJFNUT1JBR0VfQ0xBU1MiID0gIiIgLWEgIiRMT0NBTFNUT1JBR0UiICE9ICIiIF0KICAgICAgdGhlbgogICAgICAgICBlY2hvIC1lICJcblRyeWluZyB0byBnYXRoZXIgc3RvcmFnZSBjbGFzcyBmcm9tIGt1YmVybmV0ZXMgY2x1c3Rlci4uLiIKICAgICAgICAgU1RPUkFHRV9DTEFTUz1ga3ViZWN0bCAtLWt1YmVjb25maWc9L2V0Yy9rdWJlcm5ldGVzL2FkbWluLmNvbmYgZ2V0IHB2IC1vIGN1c3RvbS1jb2x1bW5zPVNUT1JBR0VDTEFTUzouc3BlYy5zdG9yYWdlQ2xhc3NOYW1lIDI+L2Rldi9udWxsfCBncmVwIC12ICJTVE9SQUdFQ0xBU1MiIHwgaGVhZCAtMWAKICAgICAgICAgaWYgWyAkPyAtbmUgMCBdCiAgICAgICAgIHRoZW4gCiAgIAkgICAgZWNobyAiTm8gc3RvcmFnZSBjbGFzcyBpcyBkZWZpbmVkLi4uLnRoZXJlZm9yZSAkTE9DQUxTVE9SQUdFIGlzIHVzZWQhLi4uZW5mb3JjaW5nIHN0b3JhZ2UgY2xhc3M9bG9jYWwtc3RvcmFnZSIgCiAgIAkgICAgU1RPUkFHRV9DTEFTUz0ibG9jYWwtc3RvcmFnZSIKICAgICAgICAgZWxzZQogICAgICAgICAgICBMT0NBTFNUT1JBR0U9YGt1YmVjdGwgLS1rdWJlY29uZmlnPS9ldGMva3ViZXJuZXRlcy9hZG1pbi5jb25mIGdldCBwdiAtbyBjdXN0b20tY29sdW1ucz1MT0NBTFNURzouc3BlYy5sb2NhbC5wYXRoIDI+L2Rldi9udWxsIHwgZ3JlcCAtdiAiTE9DQUxTVEciIHwgaGVhZCAtMWAKICAgICAgICAgICAgaWYgWyAiJExPQ0FMU1RPUkFHRSIgPSAiIiBdCiAgICAgICAgICAgIHRoZW4KICAgICAgICAgICAgICAgTE9DQUxTVE9SQUdFPSIkTE9DQUxfU1RPUkFHRSIKICAgICAgICAgICAgICAgU1RPUkFHRV9DTEFTUz0ibG9jYWwtc3RvcmFnZSIKICAgICAgICAgICAgZWxzZQogICAJICAgICAgIExPQ0FMU1RPUkFHRT1gZGlybmFtZSAkTE9DQUxTVE9SQUdFYAogICAgICAgICAgICBmaQogICAgICAgICBmaQogICAgICBlbGlmIFsgIiRMT0NBTF9TVE9SQUdFIiAhPSAiIiAtYSAiJFNUT1JBR0VfQ0xBU1MiICE9ICIiIF0KICAgICAgdGhlbgogICAgICAgICBlY2hvICItbCBwYXJhbWV0ZXIgaXMgaWdub3JlZCBhcyBzdG9yYWdlIGNsYXNzIGhhcyBiZWVuIHNwZWNpZmllZCEhIgogICAgICAgICBlY2hvICJVc2luZyBrdWJlcm5ldGVzIHN0b3JhZ2UgY2xhc3MgJFNUT1JBR0VfQ0xBU1MiCiAgICAgICAgIExPQ0FMU1RPUkFHRT0iTm9uZSIKICAgICAgZWxzZQogICAgICAgICBlY2hvICJVc2luZyBsb2NhbCBzdG9yYWdlIHByZXZpb3VzIHNldHRpbmcuLi4uLiIKICAgICAgZmkKICAgZmkgCgogICBpZiBbIGBlY2hvICRTVE9SQUdFX0NMQVNTIHwgZ3JlcCBsb2NhbCB8IHdjIC1sYCAtbmUgMCBdCiAgIHRoZW4KICAgICAgY2hlY2tfZGlza3NwYWNlCiAgIGZpCgogICBnZXRfZGlzdHJvX3ZlcnNpb24KCiAgIFtbICIkKGVjaG8gJE1PREUgfCBncmVwIHJlc2V0IHwgY3V0IC1mMSAtZCctJykiID0gInJlc2V0IiB8fCAiJE1PREUiID0gImFkZC13b3JrZXIiIF1dICYmID4gJFBST0dSRVNTX0ZJTEUgJiYgPiAkTE9HX0ZJTEUgJiYgZWNobyAtZSAiXG5cblJlc2V0dGluZyBhbGwgY29uZmlndXJhdGlvbi4uLi4gUmVpbnN0YWxsIGV2ZXJ5dGhpbmcgZnJvbSBzY3JhdGNoIS4uLlxuIiAmJiBlY2hvIC1lICJTaHV0ZG93biBrdWJlbGV0IGFuZCBrdWJlcm5ldGVzLi4uLi4gIiAKIyYmIGtpbGxfa3ViZWxldF9hbmRfazhzCgogICBleHBvcnQgS1VCRUFETUFSRz0iIgogICBVU0VSRlJPTUZJTEU9YHNlZCAtbiAncy9eVVNFUj1cKFthLXpBLVowLTldXCtcKS9cMS9wJyAkUFJPR1JFU1NfRklMRWAKICAgaWYgWyAiJFVTRVJGUk9NRklMRSIgIT0gIiRUSEVVU0VSIiAtYSAiJFVTRVJGUk9NRklMRSIgIT0gIiIgXQogICB0aGVuCiAgICAgIFtbIC1kIC9ob21lLyRVU0VSRlJPTUZJTEUgXV0gJiYgVEhFVVNFUj0iJFVTRVJGUk9NRklMRSIKICAgZmkKCiAgIGVjaG8gLWUgIllvdSBhcmUgcnVubmluZyBMaW51eCBkaXN0cm8gOiAkRElTVFJPICRBTExWRVIgLi4uLi4iCiAgIGVjaG8gLWUgIlxufn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fiIKICAgZWNobyAtZSAiJFRIRU1FU1NBR0UiCiAgIGVjaG8gLWUgIlxuUnVubmluZyBrdWJlcm5ldGVzIG9uIGEgJFRIRU5PREUgbm9kZSIKICAgZWNobyAtZSAiXG5LdWJlIFJlZ3VsYXIgdXNlciAgIDogJFRIRVVTRVIgIgogICBlY2hvIC1lICJcbkt1YmVsZXQgc3RvcmFnZSAgICAgOiAkS1VCRVNUT1JBR0UgIiAKICAgZWNobyAtZSAiXG5Db250YWluZXJzIHN0b3JhZ2UgIDogJENPTlRBSU5FUlNUT1JBR0UgIiAKICAgZWNobyAtZSAiXG5Vc2luZyBzdG9yYWdlIGNsYXNzIDogJFNUT1JBR0VfQ0xBU1MgIgogICBbWyAiJE1PREUiID0gInJlc2V0LXdvcmtlciIgfHwgIiRNT0RFIiA9ICJhZGQtd29ya2VyIiBdXSAmJiBORVRQTFVHSU49ImZvbGxvdyBNYXN0ZXIgbm9kZSIKICAgZWNobyAtZSAiXG5OZXR3b3JrIHBsdWdpbiAgICAgIDogJE5FVFBMVUdJTiAiCiAgIGVjaG8gLWUgIlxufn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+flxuXG4iCiAgIGluc3RhbGxfcHJlcmVxcwogICBtb2RpZnlfc3NsX2NvbmZpZwogICBzZXR1cF9rOHMKICAgW1sgIiRNT0RFIiA9ICJzaW5nbGUiICB8fCAiJE1PREUiID0gInJlc2V0LXNpbmdsZSIgXV0gJiYgdW50YWludF9tYXN0ZXJfbm9kZQoKICAgRVJST1I9YHN1IC0gJFRIRVVTRVIgLWMgImt1YmVjdGwgZ2V0IG5vZGVzIHwgZ3JlcCBcIi4qZXJyb3IuKlwiIiAyPiYxYAogICB3aGlsZSBbICIkRVJST1IiICE9ICIiIF0KICAgZG8KICAgICAgW1sgIiRFUlJPUiIgPX4gLipjb21tYW5kW1s6c3BhY2U6XV1ub3RbWzpzcGFjZTpdXS4qIF1dICYmIGVjaG8gIkNvcnJ1cHRlZCBpbnN0YWxsYXRpb24sIGV4aXRpbmcuLi4iICYmIGV4aXQgMQogICAgICBlY2hvICJFcnJvciAkRVJST1IgLCB0aGUga3ViZWxldCBtYXkgbm90IGJlIHJ1bm5pbmcsIG9yIGt1YmVybmV0ZXMgaXMgYnJva2VuLi5leGl0aW5nLi4uLiIgCiAgICAgIGVjaG8gIkhvd2V2ZXIsIGl0IG1heSBiZSB0aGUgcHJvYmxlbSB3aXRoIHRoZSBjb25maWcgZmlsZSBpcyBub3QgY29waWVkLi4iCiAgICAgIGlmIFsgIiQoZWNobyAkTU9ERSB8IGdyZXAgd29ya2VyIHwgY3V0IC1mMiAtZCctJykiID0gIndvcmtlciIgXQogICAgICB0aGVuCiAgICAgICAgIGNwIC9ldGMva3ViZXJuZXRlcy9hZG1pbi5jb25mIC9ob21lLyRUSEVVU0VSLy5rdWJlL2NvbmZpZwogICAgICBlbHNlCiAgICAgICAgIE1BU1RFUk5PREU9YGVjaG8gJEtVQkVBRE1fSk9JTl9DTUQgfCBhd2sgJ3twcmludCAkM30nIHwgY3V0IC1mMSAtZCc6J2AKICAgICAgICAgc2NwIC1vICJTdHJpY3RIb3N0S2V5Q2hlY2tpbmcgbm8iICR7TUFTVEVSTk9ERX06L2V0Yy9rdWJlcm5ldGVzL2FkbWluLmNvbmYgL2hvbWUvJFRIRVVTRVIvLmt1YmUvY29uZmlnCiAgICAgIGZpCiAgICAgIEVSUk9SPWBzdSAtICRUSEVVU0VSIC1jICJrdWJlY3RsIGdldCBub2RlcyB8IGdyZXAgXCIuKmVycm9yLipcIiIgMj4mMWAKICAgICAgc2xlZXAgMgogICBkb25lCgogICBpc19jbHVzdGVyX3JlYWR5CiAgIFtbICIkTU9ERSIgPSAic2luZ2xlIiAgfHwgIiRNT0RFIiA9ICJyZXNldC1zaW5nbGUiIF1dICYmIHVudGFpbnRfbWFzdGVyX25vZGUKICAgW1sgIiRNT0RFIiA9ICJyZXNldC1tYXN0ZXIiIF1dICYmIGVjaG8gIkluc3RhbGxpbmcgazhzIGRhc2hib2FyZC4uLi4iICYmIGluc3RhbGxfazhzX2Rhc2hib2FyZAoKCiAgIGlmIFsgYGVjaG8gJFNUT1JBR0VfQ0xBU1MgfCBncmVwIGxvY2FsIHwgd2MgLWxgIC1uZSAwIF0KICAgdGhlbgogICAgICBzZXR1cF9sb2NhbF9kaXNrCiAgIGZpCgogICBpZiBbICIkTU9ERSIgPSAicmVzZXQtd29ya2VyIiBdCiAgIHRoZW4gCiAgICAgIGVjaG8gIlNldHRpbmcgdGhpcyBzZXJ2ZXIgYXMgYSB3b3JrZXIgbm9kZS4uIiAKICAgZWxpZiBbICIkTU9ERSIgPSAicmVzZXQtc2luZ2xlIiBdCiAgIHRoZW4KICAgICAgW1sgIiRMT0NBTFNUT1JBR0UiID0gIiRMT0NBTF9TVE9SQUdFIiBdXSAmJiBzZXR1cF9sb2NhbF9kaXNrCiAgIGVsaWYgWyAiJE1PREUiID0gImFkZC13b3JrZXIiIF0KICAgdGhlbgogICAgICBlY2hvICJBZGRpbmcgd29ya2VyIG5vZGUgb25seS4uLiBleGl0aW5nLi4uLiIKICAgICAgZXhpdCAwCiAgIGVsc2UKICAgICAgUk9MRT1gc3UgLSAkVEhFVVNFUiAtYyAia3ViZWN0bCBnZXQgbm9kZXMgLS1uby1oZWFkZXJzPXRydWUgfCBncmVwICQoaG9zdG5hbWUgLXMpIHwgYXdrICd7cHJpbnQgXFwkM30nImAKICAgICAgaWYgWyAiJE1PREUiID0gInNpbmdsZSIgXQogICAgICB0aGVuCiAgICAgICAgIGVjaG8gIlVzaW5nIHN0b3JhZ2UgY2xhc3MgJFNUT1JBR0VfQ0xBU1MiCgkgaWYgWyAiJFNUT1JBR0VfQ0xBU1MiID0gImxvY2FsLXN0b3JhZ2UiIF0KCSB0aGVuCiAgICAgICAgICAgIGVjaG8gIk1vdW50aW5nIGxvY2FsLXN0b3JhZ2UgJHtMT0NBTFNUT1JBR0V9Li4uIgogICAgICAgICAgICBmb3IgaSBpbiAkKHNlcSAxICRQVl9DT1VOVCk7IGRvCiAgICAgICAgICAgICAgICB2b2w9InZvbCRpIgogICAgICAgICAgICAgICAgW1sgISAtZCAke0xPQ0FMU1RPUkFHRX0vJHZvbCBdXSAmJiBta2RpciAtcCAke0xPQ0FMU1RPUkFHRX0vJHZvbAogICAgICAgICAgICAgICAgaWYgWyAiJChkZiAke0xPQ0FMU1RPUkFHRX0vJHZvbCB8IGF3ayAne3ByaW50ICRORn0nIHwgc2VkIDFkKSIgPSAiJHtMT0NBTFNUT1JBR0V9LyR2b2wiIF0KCSAgICAgICAgdGhlbgoJCSAgIHJtIC1yZiAke0xPQ0FMU1RPUkFHRX0vJHZvbC8qCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICBtb3VudCAtLWJpbmQgJHtMT0NBTFNUT1JBR0V9LyR2b2wgJHtMT0NBTFNUT1JBR0V9LyR2b2wKCSAgICAgICAgZmkKICAgICAgICAgICAgZG9uZQoJIGZpCiAgICAgIGVsc2UKICAgICAgICAgaWYgWyAiJFJPTEUiID0gIm1hc3RlciIgXQogICAgICAgICB0aGVuCiAgICAgICAgICAgIGVjaG8gIlRoaXMgc2VydmVyICQoaG9zdG5hbWUgLXMpIGlzICRST0xFIG5vZGUiCiAgICAgICAgICAgIGVjaG8gIkV4aXRpbmcuLi4iCiAgICAgICAgICAgIGV4aXQgMQogICAgICAgICBmaQogICAgICBmaQogICBmaQp9IHwgdGVlICRMT0dfRklMRQo=" | base64 -d > setup-k8scrio.sh
}
